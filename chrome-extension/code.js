var GBP_BUSINESS_MANAGEMENT_PAGE,must_continue=!0,categories_process=!1,can_run_categories_process=!1,already_sent_categories=!1,is_fast_check=!1,running_checklist=!1,gbp_extension_values={},main_location_for_category_data={},global_maps_self_page_place_id="",global_maps_self_page_kg_id="",global_maps_self_page_place_name="",MAX_CATEGORIES_AUDIT_ALLOWED_LOCATIONS=55,MAX_POSTS_ALLOWED=40,MAX_REVIEW_AUDIT_ALLOWED_REVIEWS=1e3,MAX_LOCATIONS_ALLOWED_FOR_MAPS_AREA_HEALTH_CHECK=100,gmbeverywhere_css_removal="",skip_media_execution=!1;let app_root_url="https://app.gbpcheck.com",app_root_local_url="http://localhost:5000",api_root_url="https://api.gbpcheck.com/api",api_root_local_url="http://localhost:3000/api",api_diff_root_url_to_use="https://api.gbpcheck.com",api_diff_local_root_url_to_use="http://localhost:3000";const is_local=!1;let app_root_url_to_use=app_root_url,api_root_url_to_use=api_root_url,api_diff_root_url_to_use_to_use=api_diff_root_url_to_use;function login_for_dev(){chrome.storage.local.set({user:{id:"12cc58d15fba43efb336bb4e8402e5ba",email:"gr@goplex.co",username:"Gabriel Rocco",picture:""}})}function avaliarQualidadeConexao(){const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(!e)return-1;const{downlink:t,rtt:a,effectiveType:n}=e;return t>=50&&a<=50?4:t>=20&&a<=80?3:t>=10&&a<=120?2:t>=3&&a<=180?1:0}function get_readable_time(e){const t=Math.floor(e/1e3);if(t<60)return`${t} segundo${1!==t?"s":""}`;return`${Math.floor(t/60)}:${(t%60).toString().padStart(2,"0")} minutos`}function get_document_innerHTML_filtered(){let e=document.body.innerHTML;return e=e.replace(/<style([\s\S]*?)<\/style>/gi,""),e=e.replace(/data:image\/.*;base64,.*"/gi,""),e}function getUrlParameter(e,t){let a=e.split("?")[1].split("&");for(let e=0;e<a.length;e++){let n=a[e].split("=");if(n[0]==t)return n[1]}return""}function checkRepetition(e){if(0===e.length)return!1;const t=e[e.length-1];let a=0;for(let n=0;n<e.length;n++)e[n]===t&&a++;return a}function addCSS(e){var t=document.createElement("style");t.type="text/css",t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(t)}async function fetch_text_data_get_method(e){try{var t=await fetch(e);return await t.text()}catch{return""}}function verify_if_all_elements_exists_together(e){let t=!0;for(let a of e)if(!Boolean(document.querySelector(a))){t=!1;break}return t}function verify_if_any_element_exists(e){let t=!1;for(let a of e)if(Boolean(document.querySelector(a))){t=!0;break}return t}function compare_qty_for_list(e){let t=!0;for(let a of e)if(document.querySelectorAll(a[0]).length!=a[1]){t=!1;break}}async function saveDataToStorage(e,t){return new Promise(((a,n)=>{if(!e||void 0===t)return void n(new Error("Key and value must be provided"));const o={[e]:t};chrome.storage.local.set(o,(function(){chrome.runtime.lastError?n(chrome.runtime.lastError):a()}))}))}const readLocalStorage=async e=>new Promise(((t,a)=>{chrome.storage.local.get([e],(function(n){void 0===n[e]?a():t(n[e])}))})),readCompleteStorageData=async()=>new Promise(((e,t)=>{chrome.storage.local.get((function(t){e(void 0===t?void 0:t)}))})),deleteLocalStorage=async e=>new Promise(((t,a)=>{chrome.storage.local.remove([e],(function(n){void 0===n[e]?a():t(n[e])}))}));async function removeDataFromStorage(e){return new Promise(((t,a)=>{e?chrome.storage.local.remove(e,(function(){chrome.runtime.lastError?a(chrome.runtime.lastError):t()})):a(new Error("Key must be provided"))}))}const getUserData=async e=>new Promise(((t,a)=>{chrome.storage.local.get([e],(function(n){void 0===n[e]?a():t(n[e])}))}));function remove_problematic(e){let t="";for(let a=0;a<e.length;a++)try{encodeURI(e[a]),t+=e[a]}catch(e){continue}return t}function get_main_maps_url(e,t,a){if(!must_continue)return;let n={},o=t.email,i=t.id;return o&&i?($.ajax({type:"POST",url:api_root_url_to_use+"/healthcheck/external/"+btoa(i),async:!1,timeout:3e4,data:{method:"maps_url_c",reference_k:e,email:o,use_quotation_marks:a},success:function(e){n=e.url},error:function(){}}),n):void 0}async function get_gbp_business_management_values(e){if(!e){let t=await readCompleteStorageData();t=JSON.parse(JSON.stringify(t));const a=t.user;let n;if(n=null!=a&&!(0===Object.keys(a).length&&Object.getPrototypeOf(a)===Object.prototype),!n)return void login();e=a}if(!must_continue)return;let t={},a=e.email,n=e.id;return a&&n?($.ajax({type:"POST",url:api_root_url_to_use+"/management/get/"+btoa(n),async:!1,timeout:3e4,data:{email:a},success:function(e){t=e},error:function(e,t,a){}}),t):void 0}async function get_gbp_search_holder_extension_values(){let e={};return $.ajax({type:"POST",url:api_root_url_to_use+"/values/search/get",async:!1,timeout:3e4,success:function(t){e=t},error:function(e,t,a){}}),e}async function get_and_set_css(){$.ajax({type:"POST",url:api_root_url_to_use+"/healthcheck/external/get-css",async:!1,timeout:3e4,data:{},success:function(e){try{e.STATUS_CODES&&addCSS(e.STATUS_CODES)}catch{}},error:function(e,t,a){}})}async function get_gbp_extension_values(e){if(!e){let t=await readCompleteStorageData();t=JSON.parse(JSON.stringify(t));const a=t.user;let n;if(n=null!=a&&!(0===Object.keys(a).length&&Object.getPrototypeOf(a)===Object.prototype),!n)return void login();e=a}if(!must_continue)return;let t={},a=e.email,n=e.id;return a&&n?($.ajax({type:"POST",url:api_root_url_to_use+"/healthcheck/external/get/"+btoa(n),async:!1,timeout:3e4,data:{email:a},success:function(e){t=e,MAX_CATEGORIES_AUDIT_ALLOWED_LOCATIONS=t.MAX_CATEGORIES_AUDIT_ALLOWED_LOCATIONS,MAX_POSTS_ALLOWED=t.MAX_POSTS_ALLOWED,MAX_REVIEW_AUDIT_ALLOWED_REVIEWS=t.MAX_REVIEW_AUDIT_ALLOWED_REVIEWS,MAX_LOCATIONS_ALLOWED_FOR_MAPS_AREA_HEALTH_CHECK=t.MAX_LOCATIONS_ALLOWED_FOR_MAPS_AREA_HEALTH_CHECK},error:function(e,t,a){}}),t):void 0}function send_fallback(e,t,a){}function process_fallback(e){if(e&&must_continue)return"ERROR"==e.type?(must_continue=!1,-1):"SET_TO_NEXT"==e.type?2:"NONE"==e.type||"REPORT"==e.type?0:void 0}function process_exception(e,t){must_continue=!1,exception_message=e.message+" "+t}function remove_non_numeric(e){return e.replace(/[^0-9]/g,"")}function scroll_element(e){must_continue&&(e.scrollTop=e.scrollTop+1e4)}function sleep(e){return new Promise((t=>setTimeout(t,e)))}async function await_for_elements(e,t=0,a=!0){function n(e){for(let t=0;t<e.length;t++){if(!must_continue&&a)return{has_el:!1,qty:0,query:"",result:[]};let n=e[t],o=document.querySelectorAll(n);if(o.length)return{has_el:!0,qty:o.length,query:n,result:o}}return{has_el:!1,qty:0,query:"",result:[]}}let o=n(e);if(o.has_el)return o;for(let o of[1,2,3,4,5,6,7]){await sleep(500*o);let i=n(e);if(i.has_el||!must_continue&&a)return i;if(t>0&&o==t)return{has_el:!1,qty:0,query:"",result:[]}}return{has_el:!1,qty:0,query:"",result:[]}}function get_api_code_modal(){let e="<h1 style='text-align:center; width:100%; font-size:28px; margin-top:22px; color:white; font-weight:bold;'>LOGIN</h1>";return e+="<p style='color:white; text-align:center; font-size:16px; margin-top:30px;'>Autentique-se no <b>GBP Check</b> para iniciar</p>",e+="<div style='display:flex; margin-top: 40px; justify-content:center; padding-bottom:40px;'>",e+="<button style='height:34px; margin-top: 5px; margin-right:10px;' class='modal-sub-btn'><a target='_blank' href='https://www.gbpcheck.com/pt/solicitar-acesso/'>Efetuar Cadastro</a></button>",e+="<button id='check-key-btn-go' class='modal-btn login-modal-btn'>Entrar</button>",e+="</div>","<h1 style='text-align:center; width:100%; font-size:28px; margin-top:22px; color:white; font-weight:bold;'>LOGIN</h1><p style='color:white; text-align:center; font-size:16px; margin-top:30px;'>Autentique-se no <b>GBP Check</b> para iniciar</p><div style='display:flex; margin-top: 40px; justify-content:center; padding-bottom:40px;'><button style='height:34px; margin-top: 5px; margin-right:10px;' class='modal-sub-btn'><a target='_blank' href='https://www.gbpcheck.com/pt/solicitar-acesso/'>Efetuar Cadastro</a></button><button id='check-key-btn-go' class='modal-btn login-modal-btn'>Entrar</button></div>"}function auth_user(){chrome.runtime.sendMessage({method:"get_tab"},(function(e){chrome.storage.local.set({tab_id:e.tab_id},(function(){let e=document.createElement("a"),t=chrome.runtime.getManifest().version;e.href=app_root_url_to_use+"/extension/auth?version="+t,e.target="_blank",e.click()}))}))}function login(){open_modal(get_api_code_modal()),document.getElementById("check-key-btn-go").addEventListener("click",auth_user)}function request_url_for_reviews_card(e){let t=e.email,a=e.id;t&&a&&$.ajax({type:"POST",url:"https://api.gbpcheck.com/cards/new/"+btoa(a),async:!1,timeout:3e4,data:{data:document.body.getHTML(),email:t},success:function(e){if(e.url){let t=document.createElement("a");t.href=e.url,t.target="_blank",t.click()}},error:function(e,t,a){}})}function process_data(e,t,a="",n,o){if(o||(o="-1"),"cancel"==t||!must_continue)return;let i={},r=n.email,s=n.id;if(!r||!s)return;try{encodeURI(e)}catch(t){e=remove_problematic(e)}const l=api_root_url_to_use+"/healthcheck/external/"+btoa(s);return $.ajax({type:"POST",url:l,async:!1,timeout:3e4,data:{data:e,method:t,reference_k:a,email:r,add_data:o},success:function(e){i=e},error:function(e,t,a){}}),i}function open_modal(e){let t=document.getElementById("gbp-check-modal-content"),a=document.getElementById("gbp-check-modal");a.style.display="block";let n=document.createElement("div");n.className="gbp-check-modal-header",n.innerHTML='<span class="close">&times;</span>',t.innerHTML="",t.appendChild(n),t.innerHTML+=e,document.getElementsByClassName("close")[0].onclick=function(){a.style.display="none"}}function set_modal(){let e=document.createElement("div");e.className="modal",e.id="gbp-check-modal";let t=document.createElement("div");t.className="modal-content",t.id="gbp-check-modal-content",e.appendChild(t),document.body.appendChild(e);var a=document.getElementById("gbp-check-modal");window.onclick=function(e){e.target==a&&(a.style.display="none")}}function send_set_for_view(e,t){if(!must_continue)return;let a=t.email,n=t.id;a&&n&&$.ajax({type:"POST",url:api_root_url_to_use+"/healthcheck/external/"+btoa(n),async:!1,timeout:3e4,data:{method:"cv",reference_k:e,email:a},success:function(e){},error:function(){}})}async function set_health_check_for_view(){send_set_for_view(await readLocalStorage("reference_k"),await getUserData("user"))}function finish_health_check(){if(!must_continue)return;document.getElementById("gbp-check-progress-bar-progress").style.width="100%";let e='<p class="modal-main-text">Pré Análise de Saúde Concluída com Sucesso.</p>';e+='<img src="chrome-extension://eahmehikldfandakklkgiobdnmmhbhle/images/gbp-check-v-green-250.png" class="copy-icon" style="width: 70px; height: 70px; margin-left: calc(50% - 35px); margin-top: 25px;">',e+='<div class="modal-buttons-holder">',e+='<p class="modal-redirect-text">Redirecionando...</p>',e+="</div>",open_modal('<p class="modal-main-text">Pré Análise de Saúde Concluída com Sucesso.</p><img src="chrome-extension://eahmehikldfandakklkgiobdnmmhbhle/images/gbp-check-v-green-250.png" class="copy-icon" style="width: 70px; height: 70px; margin-left: calc(50% - 35px); margin-top: 25px;"><div class="modal-buttons-holder"><p class="modal-redirect-text">Redirecionando...</p></div>'),setTimeout((()=>{let e=document.createElement("a");e.href=app_root_url_to_use+"/extension/healthcheck",e.click()}),1500)}async function finish_reviews_audit(){document.getElementById("gbp-check-progress-bar-progress").style.width="100%";let e='<p class="modal-main-text">Análise de Avaliações Concluída com Sucesso.</p>';e+='<img src="chrome-extension://eahmehikldfandakklkgiobdnmmhbhle/images/gbp-check-v-green-250.png" class="copy-icon" style="width: 70px; height: 70px; margin-left: calc(50% - 35px); margin-top: 25px;">',e+='<div class="modal-buttons-holder">',e+='<p class="modal-redirect-text">Redirecionando...</p>',e+="</div>",open_modal('<p class="modal-main-text">Análise de Avaliações Concluída com Sucesso.</p><img src="chrome-extension://eahmehikldfandakklkgiobdnmmhbhle/images/gbp-check-v-green-250.png" class="copy-icon" style="width: 70px; height: 70px; margin-left: calc(50% - 35px); margin-top: 25px;"><div class="modal-buttons-holder"><p class="modal-redirect-text">Redirecionando...</p></div>'),await sleep(1200);let t=document.createElement("a");t.href=app_root_url_to_use+"/extension/reviews",t.click()}function remove_progress_bar(){var e=["gbp-check-progress-bar","gbp-check-progress-bar-progress","gbp-check-progress-child","gbp-check-progress-cancel","gbp-check-progress-child-counter-step","gbp-check-progress-child-counter-counter","gbp-check-progress-child-label","fading-div","user_stand_by_warning_main","gbp-check-skip-media-area"];for(let t=0;t<e.length;t++){let a=document.getElementById(e[t]);a&&a.remove()}}function change_gbp_check_step(e){must_continue&&(document.getElementById("gbp-check-progress-child-counter-step").innerText=e)}function change_gbp_check_counter(e){must_continue&&(document.getElementById("gbp-check-progress-child-counter-counter").innerText=e+"")}function change_health_check_to_error(e){must_continue=!1,running_checklist=!1;let t=document.getElementById("user_stand_by_warning_label");t&&(t.innerText=e,t.classList.contains("label-warn-normal")&&t.classList.remove("label-warn-normal"),t.classList.contains("label-warn-error")||t.classList.add("label-warn-error"))}function add_progress_bar(e,t,a){let n=document.getElementById("gbp-check-progress-bar"),o=document.getElementById("gbp-check-progress-child"),i=document.getElementById("gbp-check-progress-cancel"),r=document.getElementById("user_stand_by_warning_main"),s=document.getElementById("fading-div");n&&n.remove(),o&&o.remove(),i&&i.remove(),r&&r.remove(),s&&s.remove();let l=document.createElement("div");l.id="gbp-check-progress-bar";let c=document.createElement("div");c.style.width=e,c.id="gbp-check-progress-bar-progress";let _=document.createElement("div");_.id="gbp-check-progress-child",_.className="gbp-check-progress-child second_child_progress_status";let u=document.createElement("div");u.id="gbp-check-progress-cancel",u.innerHTML="&times;",u.onclick=function(){must_continue=!1,running_checklist=!1,categories_process=!1,can_run_categories_process=!1,already_sent_categories=!1,is_fast_check=!1,chrome.storage.local.remove("reviews_audit_storage_start_owner",(function(){})),chrome.storage.local.remove("get_reviews_for_health_check_owner",(function(){})),chrome.storage.local.get((function(e){let t;if(!e.user)return;t=e.user;let a={status:{method:"cancel"},user:t};chrome.storage.local.set(a,(function(){})),remove_progress_bar()}))};let d=document.createElement("div");d.className="gbp-check-progress-child-counter",d.id="gbp-check-progress-child-counter-step",d.innerText=a,d.style.left="6.5%";let p=document.createElement("div");p.className="gbp-check-progress-child-counter",p.id="gbp-check-progress-child-counter-counter",p.innerText="-",p.style.left="80.5%";let m=document.createElement("div");m.id="gbp-check-progress-child-label",m.className="gbp-check-progress-child-label",m.innerText=t;const g=chrome.runtime.getManifest().version;let h=document.createElement("div");h.id="user_stand_by_warning_main",h.className="gbp-check-progress-child first_child_progress_warn",h.innerHTML=`\n\n    <div style="display: flex;justify-content: space-around;" class="gbp-check-progress-child-label label-warn label-warn-normal" id="user_stand_by_warning_label">\n        <p style="margin:0px; width:100%;">Mantenha a aba ativa e o mouse parado</p>\n        <div id="gbp_version_label" style="font-weight:bold; margin-left:-13%;">v${g}</div>\n    </div>\n    `;let f=document.createElement("a");f.href=gbp_extension_values.UPDATE_URL,f.target="_blank",f.id="gbp_update_needed_label",f.style="width: 40% !important; background:#d33d44 !important;",f.innerText="Atualize para a versão "+gbp_extension_values.CURRENT_VERSION,f.className="gbp-check-progress-child-label label-warn",_.appendChild(d),_.appendChild(m),_.appendChild(p),l.appendChild(c),gbp_extension_values.CURRENT_VERSION!=g&&(h.appendChild(f),h.style="width:45vw !important; left: 27.5vw !important;");let b=document.createElement("div");b.className="fading-div",b.id="fading-div",document.body.appendChild(b),document.body.appendChild(l),document.body.appendChild(_),document.body.appendChild(u),document.body.appendChild(h)}function add_main_gbp_check_container(e,t,a){let n=document.getElementById("main_container");n&&(n.innerHTML="",n.remove());let o=document.createElement("div");return o.id="gbp-check-main-container",o.className=a,add_health_check_button(o,e),t.appendChild(o),o}function show_copy_notification_success(e,t){let a=document.getElementById("notification_container");a&&a.remove();let n=document.createElement("div");n.id="gbp-check-notification-container",n.className="gbp-check-notification-container";let o=document.createElement("div");o.className="notification_close_button",o.innerHTML="&times;",o.onclick=()=>{n.remove()};let i=document.createElement("div");i.id="gbp-check-notification-title",i.className="gbp-check-notification-title";let r=document.createElement("div");r.id="gbp-check-notification-title-text",r.className="gbp-check-notification-title-text",r.innerText=e;let s=document.createElement("div");s.id="gbp-check-notification-value",s.className="gbp-check-notification-value",s.innerText=t,n.appendChild(o),n.appendChild(i),i.appendChild(r),n.appendChild(s),document.body.appendChild(n),setTimeout((function(){n.className="gbp-check-notification-container fadeout",setTimeout((function(){n.remove()}),1e3)}),3500)}async function copyToTheClipboard(e){const t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}function fetch_text_data_get_method_sync(e){try{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(),200===t.status?t.responseText:""}catch{return""}}function get_most_repeated_value(e){let t="",a=0;for(let n=0;n<e.length;n++){let o=e[n],i=e.filter((function(e){return e===o})).length;i>a&&(t=o,a=i)}return t}function getMostFrequentLudocidValue(){const e=document.querySelectorAll("*"),t=[];e.forEach((e=>{const a=e.getAttribute("data-rc_ludocids"),n=e.getAttribute("data-ludocid");null!==a&&t.push(a),null!==n&&t.push(n)}));const a={};let n=null,o=0;return t.forEach((e=>{a[e]=(a[e]||0)+1,a[e]>o&&(o=a[e],n=e)})),n}function extrairLudocidMaisFrequente(){const e=document.documentElement.innerHTML,t=document.createElement("textarea");t.innerHTML=e;const a=t.value,n=/href="[^"]*?[?&]ludocid=(\d+)/g,o={};let i;for(;null!==(i=n.exec(a));){const e=i[1];o[e]=(o[e]||0)+1}let r=null,s=0;for(const[e,t]of Object.entries(o))t>s&&(s=t,r=e);return r}function extrairCidMaisFrequenteDeDataFid(){const e=document.querySelectorAll("[data-fid]"),t={};e.forEach((e=>{const a=e.getAttribute("data-fid").split(":");if(2===a.length){const e=a[1],n=BigInt(e).toString();t[n]=(t[n]||0)+1}}));let a=null,n=0;for(const[e,o]of Object.entries(t))o>n&&(n=o,a=e);return a}function get_location_cid_old(){try{let e=extrairCidMaisFrequenteDeDataFid();if(e&&e.length>11)return e}catch{}try{let e=extrairLudocidMaisFrequente();if(e&&e.length>11)return e}catch{}try{let e=getMostFrequentLudocidValue();if(e&&e.length>11)return e}catch{}try{let e=document.querySelector("[data-ludocid]").getAttribute("data-ludocid");if(e)return e}catch{}try{if(cid=document.querySelector("[data-rc_ludocids]").getAttribute("data-rc_ludocids"),cid)return cid}catch{}}function get_location_cid(){const e={},t=(t,a)=>{t&&t.length>11&&(e[t]=(e[t]||0)+1)};try{document.querySelectorAll("[data-fid]").forEach((e=>{const a=e.getAttribute("data-fid").split(":");if(2===a.length){const e=a[1],n=BigInt(e).toString();t(n)}}))}catch{}try{const e=document.documentElement.innerHTML,a=document.createElement("textarea");a.innerHTML=e;const n=a.value,o=/href="[^"]*?[?&]ludocid=(\d+)/g;let i;for(;null!==(i=o.exec(n));)t(i[1])}catch{}try{document.querySelectorAll("*").forEach((e=>{const a=e.getAttribute("data-rc_ludocids"),n=e.getAttribute("data-ludocid");null!==a&&t(a),null!==n&&t(n)}))}catch{}try{const e=document.querySelector("[data-ludocid]")?.getAttribute("data-ludocid");t(e)}catch{}try{const e=document.querySelector("[data-rc_ludocids]")?.getAttribute("data-rc_ludocids");t(e)}catch{}let a=null,n=0;for(const[t,o]of Object.entries(e))o>n&&(n=o,a=t);return a}function extrairValorLuRapPlaceId(){const e=document.documentElement.innerHTML.match(/"lu-rap-thank-you-dialog"\s*,\s*"([^"]+)"/);return e?e[1]:null}function get_place_id(){try{let e=document.querySelectorAll("[data-pid]"),t=[];for(let a=0;a<e.length;a++)t.push(e[a].getAttribute("data-pid"));t=t.filter((function(e){return!/^\d+$/.test(e)})),t=t.filter((function(e){return""!=e})),t=t.filter((function(e){return e.length>18}));let a=get_most_repeated_value(t);if(a)return a}catch(e){}try{const e=extrairValorLuRap();if(e&&e.length>18)return e}catch(e){}const e=get_location_cid();let t=fetch_text_data_get_method_sync(window.location.origin+"/maps?cid="+e),a=JSON.parse(t.split("window.APP_INITIALIZATION_STATE=")[1].split(";window.APP")[0]);return a=JSON.parse(a[3][6].split("\n")[1]),most_repeated_value=a[6][78],most_repeated_value}function get_maps_url(){return"https://www.google.com/maps/place/?q=place_id:"+get_place_id()}function check_if_lat_lng_zoom_in_url(e){return!!e.match(/@-?\d+\.\d+,-?\d+\.\d+,\d+z/)}async function wait_for_maps_to_change_url(){for await(i of(await sleep(2e3),[1,2,3,4,5])){if(check_if_lat_lng_zoom_in_url(window.location.href))return;await sleep(1500*i)}}function copy_review_link(){let e=get_place_id();review_url="https://search.google.com/local/writereview?placeid="+e,value_to_clipboard(review_url,"Link De Avaliação Copiado Para Área De Transferência")}async function value_to_clipboard(e,t){await copyToTheClipboard(e),show_copy_notification_success(t,e)}function request_ranking_for_user(){let e=get_place_id();window.open("https://app.gbpcheck.com/agency/ranking?pidn="+btoa(e),"_blank")}async function request_data_for_reviews_card_with_user(){let e=await readCompleteStorageData();e=JSON.parse(JSON.stringify(e));const t=e.user;let a;if(t&&(a=0!=Object.keys(t).length&&!(Object.getPrototypeOf(t)!=Object.prototype)),null==t&&(a=!1),!a)return void login();let n=t.email,o=t.id;n&&o?request_url_for_reviews_card(t):login()}function add_secondary_container_button(e,t){if(t)return;let a=document.createElement("div");a.style.color="white",a.style.cursor="pointer",a.className="login-btn-on-main",a.style.borderRadius="20px",a.style.display="flex",a.style.justifyContent="center",a.style.alignItems="center",a.style.width="22%",a.innerHTML="<p style='text-align:center; font-weight:bold;'>Login</p>",a.onclick=function(){login()},e.appendChild(a)}function add_health_check_button(e,t){let a=document.createElement("button");a.className="main-btn start-main-check-btn",a.innerText="Pré Análise";let n=document.createElement("img");n.className="copy-icon",n.src="chrome-extension://eahmehikldfandakklkgiobdnmmhbhle/images/gmb-chec-v-transparent-white.png",a.appendChild(n);let o=document.createElement("button");o.className="main-btn",o.id="utilities-gbp-check-btn",o.innerText="Ferramentas";let i=document.createElement("div");i.id="gbp-utilities-dropdown-content",i.style.display="none";let r=document.createElement("a");r.innerText="Criar Card de Avaliação",r.id="reviews_card_btn";let s=document.createElement("a");s.innerText="Análise de Avaliações",s.id="reviews_audit_btn";let l=document.createElement("a");l.innerText="Análise de Postagens",l.id="post_audit_btn";let c=document.createElement("a");c.innerText="Análise de Categorias",c.id="categories_audit_btn";let _=document.createElement("a");_.innerText="Análise de Ranking";let u=document.createElement("a");u.innerText="Pré Análise Rápida";let d=document.createElement("a");d.className="sub-utilities-main-gbp-check-menu reverse-active",d.innerText="Copiar Link de Avaliações";let p=document.createElement("img");p.className="copy-icon",p.src="chrome-extension://eahmehikldfandakklkgiobdnmmhbhle/images/copy_paste.png",d.appendChild(p),a.onclick=function(){is_fast_check=!1,execute_search_page_health_check(!1)},u.onclick=function(){is_fast_check=!0,execute_search_page_health_check(!1)},c.onclick=function(){start_categories_audit(),categories_process=!0,can_run_categories_process=!1},r.onclick=function(){request_data_for_reviews_card_with_user()},s.onclick=function(){execute_reviews_audit()},l.onclick=function(){execute_post_audit()},d.onclick=function(){copy_review_link()},_.onclick=function(){request_ranking_for_user()};let m=document.createElement("div");m.className="gbp-check-panel-screw-holder";let g=document.createElement("div");g.className="gbp-check-panel-screw";let h=document.createElement("div");h.className="gbp-check-panel-screw-div",g.appendChild(h);let f=document.createElement("div");f.className="gbp-check-panel-screw";let b=document.createElement("div");b.className="gbp-check-panel-screw-div",f.appendChild(b),m.appendChild(g),m.appendChild(f);let y=document.createElement("div");y.className="gbp-check-panel-screw-holder";let w=document.createElement("div");w.className="gbp-check-panel-screw";let v=document.createElement("div");v.className="gbp-check-panel-screw-div",w.appendChild(v);let k=document.createElement("div");k.className="gbp-check-panel-screw";let x=document.createElement("div");x.className="gbp-check-panel-screw-div",k.appendChild(x),y.appendChild(w),y.appendChild(k),i.appendChild(m),s.style.marginTop="-20px",i.appendChild(s),i.appendChild(l),i.appendChild(c),i.appendChild(r),gbp_extension_values.show_ranking_btn&&i.appendChild(_),i.appendChild(u),i.appendChild(d),i.appendChild(y),o.appendChild(i),t?(a.style.width="59%",o.style.width="39%",i.className="dropdown-content login-dropdown"):(a.style.width="45%",o.style.width="31%",i.className="dropdown-content no-login-dropdown"),e.appendChild(a),e.appendChild(o)}function show_rule_message(e,t){if(parseFloat(chrome.runtime.getManifest().version)>=e.applyToLowerThan)return;let a;if(e.dateLimit){let t=new Date,n=new Date(e.dateLimit);t.getTime()>=n.getTime()?(a=e.textAfterDate,a||(a=e.mainText)):a=e.mainText}else a=e.mainText;let n='<p class="modal-main-text">'+a+"</p>";e.canContinueProcess?(n+="<div style='display:flex; margin-top: 40px; justify-content:center; padding-bottom:40px;'>",n+="<button id='continue-process' style='height:34px; margin-top: 5px; margin-right:10px;' class='modal-sub-btn'>Atualizar Depois</button>",n+="<button id='stop-process' class='modal-btn login-modal-btn'><a target='_blank' href='"+app_root_url_to_use+"preferences'>Atualizar Agora</a></button>",n+="</div>"):e.showUpdateNow&&(n+="<div style='display:flex; margin-top: 40px; justify-content:center; padding-bottom:40px;'>",n+="<button id='stop-process' class='modal-btn login-modal-btn'><a target='_blank' href='"+app_root_url_to_use+"preferences'>Atualizar Agora</a></button>",n+="</div>"),n+="<br><br>",open_modal(n),document.getElementById("continue-process")&&(document.getElementById("continue-process").onclick=function(){document.getElementById("gbp-check-modal").style.display="none",t()}),document.getElementById("stop-process").onclick=function(){}}function verify_user(e,t){let a=!1,n=e.email,o=e.id;if(n&&o)return $.ajax({type:"POST",url:api_root_url_to_use+"/healthcheck/external/verify/"+t+"/"+btoa(o),async:!1,timeout:3e4,data:{email:n,v:chrome.runtime.getManifest().version},success:function(e){a=e},error:function(e,t,a){}}),a}function show_error_message(e){e||(e="Este endereço de email não possui uma assinatura ativa na plataforma GBP Check.");let t='<p class="modal-main-text">'+e+"</p>";t+="<br><br>",open_modal(t)}function finish_post_audit_no_posts(){document.getElementById("gbp-check-progress-bar-progress").style.width="100%";let e='<p class="modal-main-text">Nenhuma postagem foi encontrada para esta localização.</p>';e+='<div class="modal-buttons-holder">',e+='<button id="close-modal-button-end-no-posts" class="modal-btn">Fechar</button>',e+="</div>",open_modal('<p class="modal-main-text">Nenhuma postagem foi encontrada para esta localização.</p><div class="modal-buttons-holder"><button id="close-modal-button-end-no-posts" class="modal-btn">Fechar</button></div>'),remove_progress_bar(),document.querySelector("#close-modal-button-end-no-posts").onclick=()=>{document.querySelector(".gbp-check-modal-header span.close").click()}}async function finish_post_audit(){document.getElementById("gbp-check-progress-bar-progress").style.width="100%",await sleep(200);let e='<p class="modal-main-text">Análise de Postagens Concluída com Sucesso.</p>';e+='<img src="chrome-extension://eahmehikldfandakklkgiobdnmmhbhle/images/gbp-check-v-green-250.png" class="copy-icon" style="width: 70px; height: 70px; margin-left: calc(50% - 35px); margin-top: 25px;">',e+='<div class="modal-buttons-holder">',e+='<p class="modal-redirect-text">Redirecionando...</p>',e+="</div>",open_modal('<p class="modal-main-text">Análise de Postagens Concluída com Sucesso.</p><img src="chrome-extension://eahmehikldfandakklkgiobdnmmhbhle/images/gbp-check-v-green-250.png" class="copy-icon" style="width: 70px; height: 70px; margin-left: calc(50% - 35px); margin-top: 25px;"><div class="modal-buttons-holder"><p class="modal-redirect-text">Redirecionando...</p></div>'),await sleep(1200);let t=document.createElement("a");t.href=app_root_url_to_use+"/extension/posts",t.click()}function continue_reviews_modal_after_confirmation(e){e?show_rule_message(e,start_reviews_audit_after_rule):start_reviews_audit_after_rule()}async function verify_reviews_audit_with_big_data(e){await sleep(200);let t="<p class='modal-main-text'>\n    Para analisar locais com mais de 1200 avaliações, obtenha acesso de Administrador ou Proprietário do Perfil e utilize o Relatório de Performance na aba Avaliações do GBP Check.\n    </p>";t+='<div class="modal-buttons-holder">',t+='<button id="close-modal-button" class="modal-btn mg-left">Fechar</button>',t+="</div>",open_modal('<p class=\'modal-main-text\'>\n    Para analisar locais com mais de 1200 avaliações, obtenha acesso de Administrador ou Proprietário do Perfil e utilize o Relatório de Performance na aba Avaliações do GBP Check.\n    </p><div class="modal-buttons-holder"><button id="close-modal-button" class="modal-btn mg-left">Fechar</button></div>'),document.querySelector("#close-modal-button").onclick=()=>{document.querySelector(".gbp-check-modal-header span.close").click()}}async function start_categories_audit(){let e=await readCompleteStorageData();e=JSON.parse(JSON.stringify(e));const t=e.user;let a;t&&(a=0!=Object.keys(t).length&&!(Object.getPrototypeOf(t)!=Object.prototype)),null==t&&(a=!1),a?(user_verified=verify_user(t,"categories"),user_verified.success?user_verified.rule?show_rule_message(user_verified.rule,start_categories_audit_after_rule):start_categories_audit_after_rule():show_error_message(user_verified.error)):login()}async function start_categories_audit_after_rule(){let e=await readCompleteStorageData();e=JSON.parse(JSON.stringify(e));const t=e.user;let a=t.email,n=t.id;if(!a||!n)return;if(running_checklist=!0,add_progress_bar("0%","Análise de Categorias","-"),await sleep(200),!must_continue)return;let o={status:{p:"0%",now:Date(),method:"start_categories_audit"},reference_k:"",user:t};must_continue&&chrome.storage.local.set(o,(async function(){must_continue&&(await sleep(200),window.location.href=get_maps_url())}))}async function analyze_category_of_business(){document.getElementById("gbp_check_maps_options_lateral_container")&&document.getElementById("gbp_check_maps_options_lateral_container").classList.contains("slide-in")&&document.querySelector(".gbp-check-maps-lateral-button")&&document.querySelector(".gbp-check-maps-lateral-button").click(),Object.keys(gbp_extension_values).length||(gbp_extension_values=await get_gbp_extension_values(void 0));let e=await await_for_elements(gbp_extension_values.category_audit.category,1),t=[],a=!0;if(location_category=null,e.has_el)location_category=e.result[0];else{if(a=!1,t=await parse_categories_for_location(null,!0),!t)return void show_error_message("Não foi possível identificar a categoria da localização.");if(0==t.length)return void show_error_message("Não foi possível identificar a categoria da localização.")}let n=a?location_category.innerText:t[0],o=!0;(null==t||0==t.length)&&(o=!1);let i={main_category:n,lat_and_lng_of_main_location:get_maps_lat_lng(),url:window.location.href,categories:o?t:await parse_categories_for_location(null,!0)};i.placeId=global_maps_self_page_place_id,i.name=await get_location_name_async();let r={main_location:i,locations:[]};if(must_continue)if(document.getElementById("gbp-check-progress-bar-progress").style.width="4%",await sleep(300),document.getElementById("gbp-check-progress-bar-progress").style.width="5%",await sleep(400),a)location_category.click(),analyze_category_of_business_list_for_categories_audit(r);else{chrome.storage.local.set({categories_audit_data:r},(async function(){must_continue&&await sleep(200)}));let e="https://www.google.com/maps/search/"+i.main_category+"/@"+i.lat_and_lng_of_main_location.lat+","+i.lat_and_lng_of_main_location.lng+",12z";window.location.href=e}}async function analyze_category_of_text_query_search(){if(document.getElementById("gbp_check_maps_options_lateral_container")&&document.getElementById("gbp_check_maps_options_lateral_container").classList.contains("slide-in")&&document.querySelector(".gbp-check-maps-lateral-button")&&document.querySelector(".gbp-check-maps-lateral-button").click(),Object.keys(gbp_extension_values).length||(gbp_extension_values=await get_gbp_extension_values(void 0)),location_category=document.querySelector("#searchboxinput"),!location_category)return void show_error_message("Não foi possível identificar a busca para fazer a análise.");let e={main_location:{main_category:location_category.value,url:window.location.href},locations:[]};must_continue&&(document.getElementById("gbp-check-progress-bar-progress").style.width="4%",await sleep(300),document.getElementById("gbp-check-progress-bar-progress").style.width="5%",await sleep(400),analyze_category_of_business_list_for_categories_audit(e))}async function analyze_category_of_business_list_for_categories_audit(e){await sleep(600);let t=await await_for_elements(gbp_extension_values.competitors.main_location_box.queries);if(!t.has_el)return void process_fallback(gbp_extension_values.competitors.main_location_box.fallback);change_gbp_check_counter(0);let a=t.query;t=t.result[0];let n=5,o=0;for(;!(n<=0||o>=MAX_CATEGORIES_AUDIT_ALLOWED_LOCATIONS);){if(n--,!must_continue)return;if(t=document.querySelector(a),!t)break;if(!(await await_for_elements(gbp_extension_values.competitors.locations_div.queries,2)).qty)break;for(let e of[1,2]){let a=await await_for_elements(gbp_extension_values.competitors.locations_div.queries,2);if(o=a.qty>o?a.qty:o,change_gbp_check_counter(o),o>=MAX_CATEGORIES_AUDIT_ALLOWED_LOCATIONS)break;document.getElementById("gbp-check-progress-bar-progress").style.width=5+o/2<=50?5+o/2+"%":"50%",await sleep(50*e),scroll_element(t),await sleep(300),scroll_element(t),await sleep(300)}if(o>=MAX_CATEGORIES_AUDIT_ALLOWED_LOCATIONS)break;if(await sleep(300),Boolean(document.querySelector(".m6QErb.tLjsW.eKbjU")))break;let e=await await_for_elements(gbp_extension_values.competitors.next_page.queries,2);if(!must_continue)return;if(!e.has_el)continue;e=e.result[0],e.click(),await sleep(500);let i=document.querySelector(gbp_extension_values.competitors.blocking.queries[0]);if(i)for(let e of[1,2,3,4,5])if(await sleep(400),i=document.querySelector(gbp_extension_values.competitors.blocking.queries[0]),!i&&!n)break}if(locations_el=await await_for_elements(gbp_extension_values.competitors.locations_div.queries,2),!locations_el.qty)return show_error_message("Não foi possível identificar as localizações."),running_checklist=!1,categories_process=!1,void(can_run_categories_process=!1);e.categories=locations_el.result,await sleep(2e3),request_categories_for_locations(e)}async function request_categories_for_locations(e){document.getElementById("gbp-check-progress-bar-progress").style.width="52%",await sleep(200),chrome.storage.local.get((async function(e){let t;if(!e.user)return;t=e.user;let a=t.email,n=t.id;if(!a||!n)return;let o={status:{},reference_k:"",user:t};chrome.storage.local.set(o,(async function(){}))})),await sleep(2e3),main_location_for_category_data=e.main_location;get_urls_for_multiple_locations_categories();document.getElementById("gbp-check-progress-bar-progress").style.width="55%",await sleep(200),locations_already_sent_to_parse=[],locations_already_sent_to_parse_dict={},can_run_categories_process=!0}async function finish_categories_audit(){document.getElementById("gbp-check-progress-bar-progress").style.width="100%",await sleep(200);let e='<p class="modal-main-text">Análise de Categorias Concluída com Sucesso.</p>';e+='<img src="chrome-extension://eahmehikldfandakklkgiobdnmmhbhle/images/gbp-check-v-green-250.png" class="copy-icon" style="width: 70px; height: 70px; margin-left: calc(50% - 35px); margin-top: 25px;">',e+='<div class="modal-buttons-holder">',e+='<p class="modal-redirect-text">Redirecionando...</p>',e+="</div>",open_modal('<p class="modal-main-text">Análise de Categorias Concluída com Sucesso.</p><img src="chrome-extension://eahmehikldfandakklkgiobdnmmhbhle/images/gbp-check-v-green-250.png" class="copy-icon" style="width: 70px; height: 70px; margin-left: calc(50% - 35px); margin-top: 25px;"><div class="modal-buttons-holder"><p class="modal-redirect-text">Redirecionando...</p></div>'),await sleep(1200);let t=document.createElement("a");t.href=app_root_url_to_use+"/extension/categories",t.click()}async function send_categories_audit_data(e,t){already_sent_categories||chrome.storage.local.get((async function(a){let n;if(!a.user)return;n=a.user;let o=n.email,i=n.id;o&&i&&$.ajax({type:"POST",url:api_diff_root_url_to_use_to_use+"/audit/categories/"+btoa(i),async:!1,timeout:3e4,data:{data:JSON.stringify({categories_data:e,main_location:t}),email:o},success:function(e){finish_categories_audit()},error:function(e,t,a){}})}))}async function parse_categories_for_location(e,t){e||(e=window.location.href);let a=extract_cid_from_maps_url(e);if(t)for await(i of[1,2,3,4,5]){if(a)break;await sleep(300+200*i),a=extract_cid_from_maps_url(e)}let n="https://"+window.location.hostname+"/maps?cid="+a,o=await fetch_text_data_get_method(n);if(!o)return[];try{let e=JSON.parse(o.split("window.APP_INITIALIZATION_STATE=")[1].split(";window.APP")[0]);e=JSON.parse(e[3][6].split("\n")[1]);let a=e[6][13];if(t){try{global_maps_self_page_place_id=e[6][78]}catch{global_maps_self_page_place_id="-"}try{global_maps_self_page_place_name=e[6][11]}catch{global_maps_self_page_place_name=""}try{global_maps_self_page_kg_id=e[6][89]}catch{global_maps_self_page_kg_id="-"}}return a}catch(e){return null}}async function execute_post_audit(){let e=await readCompleteStorageData();e=JSON.parse(JSON.stringify(e));const t=e.user;let a;t&&(a=0!=Object.keys(t).length&&!(Object.getPrototypeOf(t)!=Object.prototype)),null==t&&(a=!1),a?(user_verified=verify_user(t,"posts"),user_verified.success?user_verified.rule?show_rule_message(user_verified.rule,start_post_audit_after_rule):start_post_audit_after_rule():show_error_message(user_verified.error)):login()}async function start_post_audit_after_rule(){let e=await readCompleteStorageData();e=JSON.parse(JSON.stringify(e));const t=e.user;let a=t.email,n=t.id;if(!a||!n)return;if(add_progress_bar("2%","Análise de Postagens","-"),await sleep(200),!must_continue)return;let o=await await_for_elements(gbp_extension_values.POSTS_AUDIT_POST_SELECT,4);if(!o.has_el)return void finish_post_audit_no_posts();o=o.result[0],o.click(),await sleep(1e3);let i=await await_for_elements([".gWebcf.caIine"],0);if(!i.has_el)return;if(!must_continue)return;let r=i.result[0];if(!(await await_for_elements([".aYexud"],0)).has_el)return;if(!must_continue)return;let s,l=0,c=-1,_=0,u=Array.from(Array(6).keys()),d=2;for await(l of(document.getElementById("gbp-check-progress-bar-progress").style.width="3%",u)){if(r=document.querySelector(".gWebcf.caIine"),s=r.querySelectorAll(".aYexud"),change_gbp_check_counter(s.length),s.length>=MAX_POSTS_ALLOWED)break;if(await sleep(400),scroll_element(r),await sleep(600),1==l?await sleep(600):l%3==0?await sleep(500):l%3==0?await sleep(2e3):l%5==0?await sleep(3e3):l%7==0?await sleep(2500):await sleep(parseInt(1500/l)),!must_continue)return;if(s=r.querySelectorAll(".aYexud"),s.length>=MAX_POSTS_ALLOWED)break;if(s.length==c){d--;let e=0;for(let t=0;t<s.length;t++)(s[t].innerText.includes("/")||s[t].innerText.includes(",")||!s[t].innerText.includes("."))&&s[t].innerText||e++;if(e==s.length)continue;if(_++,_>=40)break}else _=0;let e=5*(l+1)<=90?5*(l+1):90;if(document.getElementById("gbp-check-progress-bar-progress").style.width=e+"%",c=s.length,!d)break}document.getElementById("gbp-check-progress-bar-progress").style.width="92%",await sleep(260);let p=document.querySelectorAll(".qTVDcf");for(let e=0;e<p.length;e++)p[e].click(),await sleep(150);document.getElementById("gbp-check-progress-bar-progress").style.width="95%",await sleep(300);let m=document.body.getHTML();try{encodeURI(m)}catch(e){m=remove_problematic(m)}$.ajax({type:"POST",url:api_diff_root_url_to_use_to_use+"/audit/posts/"+btoa(n),async:!1,timeout:3e4,data:{data:m,email:a,place_id:get_place_id()},success:function(e){finish_post_audit()},error:function(e,t,a){}})}function finish_reviews_audit_no_reviews(){document.getElementById("gbp-check-progress-bar-progress")&&(document.getElementById("gbp-check-progress-bar-progress").style.width="100%");let e='<p class="modal-main-text">Nenhuma avaliação foi encontrada para esta localização.</p>';e+='<div class="modal-buttons-holder">',e+='<button id="close-modal-button-end-no-posts" class="modal-btn">Fechar</button>',e+="</div>",open_modal('<p class="modal-main-text">Nenhuma avaliação foi encontrada para esta localização.</p><div class="modal-buttons-holder"><button id="close-modal-button-end-no-posts" class="modal-btn">Fechar</button></div>'),remove_progress_bar(),document.querySelector("#close-modal-button-end-no-posts").onclick=()=>{document.querySelector(".gbp-check-modal-header span.close").click()}}async function execute_reviews_audit(){let e=await readCompleteStorageData();e=JSON.parse(JSON.stringify(e));const t=e.user;let a;if(t&&(a=0!=Object.keys(t).length&&!(Object.getPrototypeOf(t)!=Object.prototype)),null==t&&(a=!1),!a)return void login();if(user_verified=verify_user(t,"reviews"),!user_verified.success)return void show_error_message(user_verified.error);let n=await get_total_reviews();-1!=n?n>MAX_REVIEW_AUDIT_ALLOWED_REVIEWS?verify_reviews_audit_with_big_data(user_verified.rule):continue_reviews_modal_after_confirmation(user_verified.rule):finish_reviews_audit_no_reviews()}async function execute_travel_reviews_audit(){let e=await await_for_elements([".MocG8c.o7IkCf.LMgvRb.KKjvXb"]);if(!e.has_el)return;e.result[0].click();let t=await await_for_elements(["div.OA0qNb.ncFHed > div:nth-child(2)"]);if(!t.has_el)return;t.result[0].click(),await sleep(400);let a=document.querySelector(".P2NYOe.GFm7je.sSHqwe");a||(a=document.querySelector(".d7ZjBe")),a=remove_non_numeric(a.innerText);let n=document.querySelectorAll(".Svr5cf.bKhjM").length,o=0,r=3,s=0;for(;n<a&&n<MAX_REVIEW_AUDIT_ALLOWED_REVIEWS&&s<80;){if(s++,!must_continue)return;function l(e,t){t>e&&(t=e),change_gbp_check_counter(t)}for await(i of(r=3+parseInt(n/a*100),r>=98&&(r=98),document.getElementById("gbp-check-progress-bar-progress").style.width=r+"%",[1,2,3]))o+=3,l(a,o),await sleep(100),o+=2,l(a,o),await sleep(80*i),o++,l(a,o),window.scrollBy(0,1e4),await sleep(300),window.scrollBy(0,-100),await sleep(350);if(await sleep(300),o++,l(a,o),!must_continue)return;n=document.querySelectorAll(".Svr5cf.bKhjM").length,document.querySelectorAll(".Jmi7d.TJUuge").forEach((e=>{e.click()}))}for await(i of[1,2,3,4])await sleep(80*i),await sleep(80*i),await sleep(80*i),window.scrollBy(0,1e4),await sleep(300),await sleep(80*i),window.scrollBy(0,-100),await sleep(350),await sleep(80*i);async function c(e,t,a){e!=t&&(await sleep(400),c(e,t=document.querySelectorAll(".Svr5cf.bKhjM").length,a+1))}await sleep(400),a>=MAX_REVIEW_AUDIT_ALLOWED_REVIEWS?(await c(MAX_REVIEW_AUDIT_ALLOWED_REVIEWS,n,0),n=MAX_REVIEW_AUDIT_ALLOWED_REVIEWS):(await c(a,n,0),n=a);try{l(a,n)}catch{}let _=await getUserData("user"),u=_.email,d=_.id;if(!u||!d)return;document.getElementById("gbp-check-progress-bar-progress").style.width="100%";let p=document.body.getHTML();try{encodeURI(p)}catch(m){p=remove_problematic(p)}$.ajax({type:"POST",url:api_diff_root_url_to_use_to_use+"/audit/reviews/travel/"+btoa(d),async:!1,timeout:9e4,data:{data:p,email:u},success:function(e){},error:function(e,t,a){}}),finish_reviews_audit()}async function get_total_reviews(){let e=await await_for_elements(gbp_extension_values.reviews_item_queries,2);if(e=e.result[0],!must_continue)return;if(!e)return-1;let t=e.innerText;return e?(t=t.replace(/\D/g,""),t=parseInt(t),isNaN(t)||!t?-1:t):-1}async function start_reviews_audit_after_rule(){let e=await readCompleteStorageData();e=JSON.parse(JSON.stringify(e));const t=e.user;let a=t.email,n=t.id;if(!a||!n)return;if(add_progress_bar("2%","Análise de Avaliações","-"),await sleep(130),!must_continue)return;await sleep(150),document.getElementById("gbp-check-progress-bar-progress").style.width="3%";let o=await await_for_elements(gbp_extension_values.reviews_item_queries,2);if(o=o.result[0],!o)return void finish_reviews_audit_no_reviews();let i=o.innerText;if(!o)return void finish_reviews_audit_no_reviews();if(!must_continue)return;if(await saveDataToStorage("reviews_audit_storage","reviews_audit"),o.click(),await sleep(500),i=i.replace(/\D/g,""),i=parseInt(i),change_gbp_check_counter("0/"+i),isNaN(i)||!i)return void finish_reviews_audit_no_reviews();if(change_gbp_check_counter(0),!must_continue)return;document.getElementById("gbp-check-progress-bar-progress").style.width="4%";let r=null;document.getElementById("gbp-check-progress-bar-progress").style.width="5%";let s=!1;for(let e of gbp_extension_values.detecting_ownership_on_search)document.querySelector(e)&&(s=!0);if(r=await await_for_elements(gbp_extension_values.reviews_no_travel_body,0),r=r.has_el?r.result[0]:null,!must_continue)return;if(s&&!r){let e=`https://search.google.com/local/reviews?placeid=${get_place_id()}`;if(!must_continue)return;if(await saveDataToStorage("reviews_audit_storage_start_owner","reviews_audit"),!must_continue)return;return void(window.location.href=e)}if(!must_continue)return;document.getElementById("gbp-check-progress-bar-progress").style.width="6%";let l=await await_for_elements(gbp_extension_values.reviews_no_travel_newest_first_btn,0);if(!l.has_el)return;if(!must_continue)return;let c=l.result[0];if(await sleep(1e3),c&&c.click(),!r)return;r_qty=i;let _=Array.from(Array(r_qty).keys()),u=[];for await(k of _){if(!must_continue)return;scroll_element(r),await sleep(800);let e=document.querySelectorAll(gbp_extension_values.reviews_no_travel_review_complete_element_only).length;if(e>i&&(e=i),change_gbp_check_counter(e+"/"+i),u.push(e),checkRepetition(u)>=15)break;if(!must_continue)return;let t=parseInt(e/r_qty*94);if(t<7&&(t=7),document.getElementById("gbp-check-progress-bar-progress").style.width=t+"%",r=await await_for_elements(gbp_extension_values.reviews_no_travel_body,0),r=r.has_el?r.result[0]:null,await sleep(100),e>=r_qty)break;if(e>=MAX_REVIEW_AUDIT_ALLOWED_REVIEWS)break}await sleep(500);let d=document.querySelectorAll(".review-more-link");for(let e=0;e<d.length;e++)d[e].click();document.getElementById("gbp-check-progress-bar-progress").style.width="100%",await sleep(500),chrome.storage.local.remove("reviews_audit_storage_start_owner",(function(){}));let p=document.body.getHTML();$.ajax({type:"POST",url:api_diff_root_url_to_use_to_use+"/audit/reviews/"+btoa(n),async:!1,timeout:9e4,data:{data:p,email:a,place_id:get_place_id()},success:function(e){},error:function(e,t,a){}}),finish_reviews_audit()}function execute_maps_area_health_check(){!async function(){if(await sleep(2300),!must_continue)return;const e=window.location.pathname.includes("/maps/dir/");let t=await await_for_elements(gbp_extension_values.competitors.main_location_box.queries,3);if(maps_tries=await readLocalStorage("maps_tries"),e||!t.has_el){if(4==maps_tries)return void finish_health_check();maps_tries++,await saveDataToStorage("maps_tries",maps_tries);let e=await readLocalStorage("reference_k"),t=await getUserData("user");return url=get_main_maps_url(e,t,maps_tries),void(window.location.href=url)}document.getElementById("gbp-check-progress-bar-progress").style.width="73%",await async function(){let e=await await_for_elements(gbp_extension_values.competitors.main_location_box.queries);if(!e.has_el)return void process_fallback(gbp_extension_values.competitors.main_location_box.fallback);change_gbp_check_counter(0);let t=e.query;e=e.result[0];let a=await readLocalStorage("reference_k"),n=await getUserData("user"),o=6,i=0;for(;!(o<=0||i>=MAX_LOCATIONS_ALLOWED_FOR_MAPS_AREA_HEALTH_CHECK);){o--;let r=73+parseInt(4.6*(5-o));if(r>93&&(r=93),!must_continue)return;if(document.getElementById("gbp-check-progress-bar-progress").style.width=r+"%",e=document.querySelector(t),!e)break;let s=await await_for_elements(gbp_extension_values.competitors.locations_div.queries,2);if(!s.qty)break;await sleep(100);for(let t of[1,2])change_gbp_check_counter(s.qty),scroll_element(e),await sleep(150),scroll_element(e),await sleep(100);if(s=await await_for_elements(gbp_extension_values.competitors.locations_div.queries,2),!s.qty)break;change_gbp_check_counter(s.qty),i=s.qty,await sleep(200),process_data(document.body.getHTML(),"area_d",a,n);let l=await await_for_elements(gbp_extension_values.competitors.next_page.queries,2);if(!must_continue)return;if(!l.has_el)continue;l=l.result[0],l.click(),await sleep(500);let c=document.querySelector(gbp_extension_values.competitors.blocking.queries[0]);if(c)for(let e of[1,2,3,4,5])if(await sleep(400),c=document.querySelector(gbp_extension_values.competitors.blocking.queries[0]),!c)break}document.getElementById("gbp-check-progress-bar-progress").style.width="95%"}(),must_continue&&(await set_health_check_for_view(),await sleep(350),finish_health_check())}()}async function process_maps_data(){if(await sleep(200),!must_continue)return;if(document.getElementById("gbp-check-progress-bar-progress").style.width="52%",media_el=await await_for_elements(gbp_extension_values.maps.photos.main_maps_photo_header.queries,4),!must_continue)return;if(await process_maps_basic_data(),await sleep(150),!must_continue)return;if(document.getElementById("gbp-check-progress-bar-progress").style.width="55%",chrome.storage.local.get((function(e){let t;e.user&&(t=e.user),is_fast_check=e.status.is_fast_check,chrome.storage.local.clear();let a={status:{p:"55%",now:Date(),method:"m",is_fast_check:is_fast_check},reference_k:e.reference_k,user:t};must_continue&&chrome.storage.local.set(a,(function(){}))})),!must_continue)return;let e,t,a=!1;try{if(media_el.has_el){e=media_el.result[0].querySelector("img"),t=e.src,a=gbp_extension_values.STREET_VIEW_IMG_SRC.some((e=>t.includes(e)))}}catch(e){}if(gbp_extension_values.use_media_btn_on_maps){let e=await await_for_elements(gbp_extension_values.media_btn_queries,3);return e.has_el?(e=e.result[0],e.click(),await sleep(500),await sleep(200),change_gbp_check_step("6/7"),document.getElementById("gbp-check-progress-child-label").innerText="Analisando Mídia",await sleep(700),void execute_media_page_health_check()):void chrome.storage.local.get((async function(e){let t;e.user&&(t=e.user);let a=e.reference_k,n={status:{p:"72%",now:Date(),method:"verify_area"},reference_k:a,user:t,maps_tries:0};must_continue&&chrome.storage.local.set(n,(async function(){if(url=get_main_maps_url(a,t,0),!url){if(document.getElementById("gbp-check-progress-bar-progress").style.width="90%",!must_continue)return;return await set_health_check_for_view(),await sleep(350),void finish_health_check()}window.location.href=url}))}))}if(media_el.has_el&&!a&&t)media_el=media_el.result[0];else{if(await sleep(200),!must_continue)return;if(document.getElementById("gbp-check-progress-bar-progress").style.width="72%",await sleep(200),is_fast_check){if(document.getElementById("gbp-check-progress-bar-progress").style.width="90%",!must_continue)return;return await set_health_check_for_view(),await sleep(350),void finish_health_check()}chrome.storage.local.get((async function(e){let t;e.user&&(t=e.user);let a=e.reference_k,n={status:{p:"72%",now:Date(),method:"verify_area"},reference_k:a,user:t,maps_tries:0};must_continue&&chrome.storage.local.set(n,(async function(){if(url=get_main_maps_url(a,t,0),!url){if(document.getElementById("gbp-check-progress-bar-progress").style.width="90%",!must_continue)return;return await set_health_check_for_view(),await sleep(350),void finish_health_check()}window.location.href=url}))}))}!a&&media_el&&t&&(media_el.click(),await sleep(200),change_gbp_check_step("6/7"),document.getElementById("gbp-check-progress-child-label").innerText="Analisando Mídia",await sleep(700),execute_media_page_health_check())}async function process_maps_basic_data(){let e=await readLocalStorage("reference_k"),t=await getUserData("user");if(await sleep(100),process_data(window.location.href,"map0",e,t),await sleep(100),!must_continue)return;if(document.getElementById("gbp-check-progress-bar-progress").style.width="53%",await sleep(100),!must_continue)return;await await_for_elements(gbp_extension_values.maps.utilitie_elements.location_name.queries,2),await sleep(500),time_a=new Date,content=document.body.innerHTML,time_b=new Date;let a="";try{let e=await parse_categories_for_location(window.location.href,!0);a=e.length>0?e[0]:""}catch{a=""}process_data(content,"map1",e,t,a),await sleep(100),must_continue&&(document.getElementById("gbp-check-progress-bar-progress").style.width="54%",await sleep(100))}function execute_maps_page_basic_health_check(){process_maps_data()}function send_skip_media(e,t,a){let n={},o=t.email,i=t.id;if(o&&i)return $.ajax({type:"POST",url:api_root_url_to_use+"/healthcheck/external/"+btoa(i),async:!1,timeout:3e4,data:{method:"skip_media",reference_k:e,email:o,total_media:a},success:function(e){n=e},error:function(){}}),n}function send_media_data(e,t,a,n="",o){if("cancel"==t||!must_continue)return;let i={},r=o.email,s=o.id;return r&&s?($.ajax({type:"POST",url:api_root_url_to_use+"/healthcheck/external/"+btoa(s),async:!1,timeout:3e4,data:{data:e,method:t,category_name:a,reference_k:n,email:r},success:function(e){i=e},error:function(){}}),i):void 0}async function get_media_categories_available(e=0){let t,a,n,o,i=await await_for_elements(gbp_extension_values.maps.photos.photos_categories_holder.queries,0),r=0;if(i.has_el?t=i.result[0]:r=process_fallback(gbp_extension_values.maps.photos.photos_categories_holder.fallback),!must_continue)return;if(0==r)if(a=t.children,0==a.length){if(!(++e>=3||e<0)){if(await sleep(1e3),!must_continue)return;return void get_media_categories_available(e)}{let e=await await_for_elements(gbp_extension_values.maps.photos.photos_categories_label.queries,0);if(!e.has_el)return void process_fallback(gbp_extension_values.maps.photos.photos_categories_label.fallback);a=e.result,r=2,o=e.query}}else n=i.query;else if(2==r){let e=await await_for_elements(gbp_extension_values.maps.photos.photos_categories_label.queries,0);if(!e.has_el)return void process_fallback(gbp_extension_values.maps.photos.photos_categories_label.fallback);a=e.result,o=e.query}if(!must_continue)return;let s=a.length,l=parseInt(14/s),c=[],_=await readLocalStorage("reference_k"),u=await getUserData("user");if(!must_continue)return;document.getElementById("gbp-check-progress-bar-progress").style.width="56%",await sleep(200);let d=!0;for(let t=0;t<s;t++){if(!must_continue)return;let i=a[t];if(!i)continue;let p=i.innerText;if(!p)continue;i.click(),await sleep(500);let m,g=!1;for(let e=0;e<s;e++){if(!must_continue)return;let t=a[e];if(t){for(let e=0;e<gbp_extension_values.maps.photos.photo_category_active.queries.length;e++){let a=gbp_extension_values.maps.photos.photo_category_active.queries[e];if(t.classList.contains(a)){g=!0,m=a;break}}if(g)break}}if(gbp_extension_values.preferences.do_photo_verification&&g&&m){let a;if(0==r){let e=document.querySelector(n);if(!e)return;a=e.children}else 2==r&&(a=document.querySelectorAll(o));if(a.length!=s)return e<0?void process_exception(gbp_extension_values.errors.m255,String(e)+"1"):void get_media_categories_available(-1);if(p!=a[t].innerText&&a[t].classList.contains(m))return e<0?void process_exception(gbp_extension_values.errors.m255,String(e)+"2"):void get_media_categories_available(-2);if(!a[t].classList.contains(m)){let i=0;for(;!a[t].classList.contains(m);){if(a[t].click(),await sleep(450),0==r){if(categories_holder_verifier=document.querySelector(n),!categories_holder_verifier)return;a=categories_holder_verifier.children}else 2==r&&(a=document.querySelectorAll(o));if(i++,i>=5)return e<0?void process_exception(gbp_extension_values.errors.m255,String(e)+"3"):void 0}}}let h=await await_for_elements(gbp_extension_values.maps.photos.photo_box.queries,5);if(h.qty<3&&await sleep(600),0==h.qty)continue;d=!1;let f=h.query;if(document.getElementById("gbp-check-progress-child-label").innerText="Analisando Mídia - "+p,change_gbp_check_counter(t+1),!must_continue)return;if(document.getElementById("gbp-check-progress-bar-progress").style.width=56+l*(t+1)+"%",!send_media_data(document.body.getHTML(),"md",p,_,u).continue)continue;change_gbp_check_counter(0),document.getElementById("gbp-check-progress-child-label").innerText="Analisando Mídia de Proprietário";let b=await await_for_elements(gbp_extension_values.maps.photos.media_block.queries,0);if(!b.has_el){process_fallback(gbp_extension_values.maps.photos.media_block.fallback);continue}let y,w=b.result[0],v=document.querySelectorAll(f).length;await sleep(400);let k=!1;gbp_extension_values.preferences.use_loading_spin_on_media?(y=document.querySelector(gbp_extension_values.maps.photos.loading_spin_for_media.queries[0]),y||(y=!0,k=!0)):y=!0;let x=0,E=[];if(v>=20&&y)for await(let e of Array.from({length:100},((e,t)=>t+1))){if(!must_continue)return;if(x>=gbp_extension_values.preferences.max_it_for_owner_media_scroll_if_not_using_loading_spin)break;x++,scroll_element(w),await sleep(300),scroll_element(w),await sleep(500),scroll_element(w),await sleep(300),scroll_element(w);let t=document.querySelectorAll(f).length,a=10,n=0;const o=E.reduce(((e,t)=>e+t),0)/E.length;let i=0;o>=5&&(i=parseInt(o)+3);const r=avaliarQualidadeConexao();let s=0;0==r?s=1e3:1==r?s=500:2==r&&(s=100);for await(let r of Array.from({length:10+i},((e,t)=>t+1))){if(await sleep(350),await sleep(s),await sleep(50*(o+3)),n++,t!=v){E.push(n);break}if(t=document.querySelectorAll(f).length,a--,a<=0)break;await sleep(Math.min(50*e,600))}if(scroll_element(w),t%10==0&&await sleep(400),t==v)break;v=t,gbp_extension_values.preferences.use_loading_spin_on_media?(y=document.querySelector(gbp_extension_values.maps.photos.loading_spin_for_media.queries[0]),k&&!y&&(y=!0)):y=!0}let S=await await_for_elements(gbp_extension_values.maps.photos.photo_box_selectable.queries,3);if(!S.has_el){process_fallback(gbp_extension_values.maps.photos.photo_box_selectable.fallback);continue}S=S.result;const A=S.length;let I=get_readable_time(360*A);if(A>=gbp_extension_values.media_min_to_skip){let e=`\n                <div style="display:flex; justify-content:space-between; align-items:center; gap:20px;">\n                    <p style="font-size: 13px; color: #000;">Encontramos ${A} mídias, o que pode demorar um pouco para verificar. Tempo estimado para a verificação: <span id="media-verification-time">${I}</span> </p>\n                    <a style="padding:8px; cursor:pointer; background:black; color:white; border-radius:20px; font-size:12px;" id="skip-media-check">Pular verificação de mídia</a>\n                </div>\n            `,t=document.createElement("div");t.id="gbp-check-skip-media-area",t.innerHTML=e,t.style.width="880px",t.style.textAlign="center",t.style.marginTop="10px",t.style.position="fixed",t.style.top="118px",t.style.zIndex="2147483647",t.style.padding="5px 10px",t.style.backgroundColor="rgb(199, 199, 199)",t.style.borderRadius="20px",t.style.left="calc(50vw - 455px)",document.body.appendChild(t),document.getElementById("skip-media-check").addEventListener("click",(async function(){skip_media_execution=!0}))}c=[];for(let e=0;e<A;e++){if(skip_media_execution){send_skip_media(await readLocalStorage("reference_k"),await getUserData("user"),A);const e=document.getElementById("gbp-check-skip-media-area");return void(e&&e.remove())}if(!must_continue)return;S[e].click(),await sleep(350),change_gbp_check_counter(e+1+"/"+A),[...document.querySelectorAll("span")].filter((e=>e.textContent.toLowerCase().includes("captur"))).forEach((e=>c.push(String(e.textContent))));let t=e+1;I=get_readable_time(360*(A-t));let a=document.getElementById("media-verification-time");a&&360*(A-t)>0&&(a.innerText=I)}let T=new Set(c),C=Array.from(T),L=await readLocalStorage("reference_k");process_data(JSON.stringify(C),"md_d",L,u)}d&&process_exception(gbp_extension_values.errors.m256,"")}async function process_media(){if(await sleep(150),must_continue&&(change_gbp_check_counter(0),await get_media_categories_available(),await sleep(200),must_continue)){if(document.getElementById("gbp-check-progress-bar-progress").style.width="72%",await sleep(200),is_fast_check){if(document.getElementById("gbp-check-progress-bar-progress").style.width="90%",!must_continue)return;return await set_health_check_for_view(),await sleep(350),void finish_health_check()}chrome.storage.local.get((async function(e){let t;e.user&&(t=e.user);let a=e.reference_k,n={status:{p:"72%",now:Date(),method:"verify_area"},reference_k:a,user:t,maps_tries:0};must_continue&&chrome.storage.local.set(n,(async function(){if(url=get_main_maps_url(a,t,0),!url){if(document.getElementById("gbp-check-progress-bar-progress").style.width="90%",!must_continue)return;return await set_health_check_for_view(),await sleep(350),void finish_health_check()}window.location.href=url}))}))}}function execute_media_page_health_check(){process_media()}async function execute_travel_reviews_health_check(){let e=await await_for_elements([".MocG8c.o7IkCf.LMgvRb.KKjvXb"]);if(!e.has_el)return;e.result[0].click();let t=await await_for_elements(["div.OA0qNb.ncFHed > div:nth-child(2)"]);if(!t.has_el)return;t.result[0].click(),await sleep(400),document.getElementById("gbp-check-progress-bar-progress").style.width="37.5%";let a=document.querySelector(".YRxmGc");a||(a=document.querySelector(".sSHqwe")),a=remove_non_numeric(a.innerText);let n=document.querySelectorAll(".Svr5cf.bKhjM").length,o=0,r=39;for(;a-n>20;){if(!must_continue)return;if(r+=1,r<=48){if(!must_continue)return;document.getElementById("gbp-check-progress-bar-progress").style.width=r+"%"}function s(e,t){t>e&&(t=e),change_gbp_check_counter(t)}for await(i of[1,2,3])o++,s(a,o),await sleep(100),o++,s(a,o),await sleep(80*i),o++,s(a,o),window.scrollBy(0,1e4),await sleep(300),window.scrollBy(0,-100),await sleep(350);await sleep(110),o++,s(a,o);let l=await readLocalStorage("reference_k"),c=await getUserData("user"),_=process_reviews_data(document.body,l,c,"travel_r");if(o++,s(a,o),!must_continue)return;if(!_.continue)break;n=document.querySelectorAll(".Svr5cf.bKhjM").length}chrome.storage.local.get((function(e){let t;e.user&&(t=e.user);let a=e.reference_k,n=e.status.next_url;is_fast_check=e.status.is_fast_check;let o={status:{p:"50%",now:Date(),method:"map",is_fast_check:is_fast_check},reference_k:a,user:t};must_continue&&chrome.storage.local.set(o,(function(){must_continue&&(window.location.href=n)}))}))}function process_reviews_data(e,t,a,n){if(!must_continue)return;let o={},i=a.email,r=a.id;return i&&r?($.ajax({type:"POST",url:api_root_url_to_use+"/healthcheck/external/"+btoa(r),async:!1,timeout:3e4,data:{data:e.getHTML(),method:n,reference_k:t,email:i},success:function(e){o=e},error:function(){}}),o):void 0}function open_ownership_modal(){open_modal(`\n    \n    <p class="modal-main-text">${gbp_extension_values.textowner}</p>\n\n    <div class="modal-buttons-holder">\n        <button class="modal-btn" id="close-modal">Cancelar</button>\n        <button class="modal-btn mg-left" id="open-exp">Saiba Mais</button>\n        <button class="modal-btn mg-left" id="continue-force-pre-hc">Continuar</button>\n    </div>\n\n    `),document.getElementById("continue-force-pre-hc").addEventListener("click",(function(){document.getElementById("gbp-check-modal").style.display="none",execute_search_page_health_check(!0)})),document.getElementById("close-modal").addEventListener("click",(function(){document.getElementById("gbp-check-modal").style.display="none"})),document.getElementById("open-exp").addEventListener("click",(function(){window.open("https://www.gbpcheck.com/pt/suporte/conceitos-basicos-pre-analise/","_blank")}))}function goto_maps_page(e){must_continue&&(document.getElementById("gbp-check-progress-bar-progress").style.width="50%",chrome.storage.local.get((function(t){let a;t.user&&(a=t.user),is_fast_check=t.status.is_fast_check;let n={status:{p:"50%",now:Date(),method:"map",is_fast_check:is_fast_check},reference_k:e,user:a};must_continue&&chrome.storage.local.set(n,(function(){must_continue&&(window.location.href=get_maps_url())}))})))}async function get_reviews_for_health_check(e){let t=!1;for(let e of gbp_extension_values.detecting_ownership_on_search)document.querySelector(e)&&(t=!0);if(t){let t=null;for await(i of[1,2,3,4,5])if(await sleep(500*i),t=document.querySelector(gbp_extension_values.reviews_no_travel_body),t)break;if(!t){let t=`https://search.google.com/local/reviews?placeid=${get_place_id()}`;if(!must_continue)return;if(await saveDataToStorage("get_reviews_for_health_check_owner",JSON.stringify(e)),!must_continue)return;return must_continue=!1,void(window.location.href=t)}}if(await sleep(150),!must_continue)return;document.getElementById("gbp-check-progress-bar-progress").style.width="36%";let a=await await_for_elements(gbp_extension_values.reviews_item_queries,2);if(a=a.result[0],!a)return document.getElementById("gbp-check-progress-bar-progress").style.width="49%",void await sleep(300);("#"!=a.getAttribute("href")||a.getAttribute("href").includes("/travel"))&&(chrome.storage.local.get((function(e){let t;e.user&&(t=e.user);let n=e.reference_k;is_fast_check=e.status.is_fast_check;let o={status:{p:"35%",now:Date(),method:"travel_reviews",next_url:get_maps_url(),is_fast_check:is_fast_check},reference_k:n,user:t};must_continue&&chrome.storage.local.set(o,(function(){must_continue&&a.click()}))})),await sleep(2e3)),a.click();let n=await readLocalStorage("reference_k"),o=await getUserData("user");if(!must_continue)return;document.getElementById("gbp-check-progress-bar-progress").style.width="37%";let r=await await_for_elements(gbp_extension_values.reviews_no_travel_body,0);if(!r.has_el)return;if(!must_continue)return;let s=r.result[0],l=await await_for_elements(gbp_extension_values.reviews_no_travel_newest_first_btn,0);if(!l.has_el)return;if(!must_continue)return;let c=l.result[0];function _(e,t){t>e&&(t=e),change_gbp_check_counter(t)}await sleep(150),c&&c.click(),document.getElementById("gbp-check-progress-bar-progress").style.width="38%",await sleep(1e3);let u=38;r_qty=parseInt(e.q);let d=parseInt(e.t),p=0;if(!d){let e=s.querySelector(".review-score-container");if(e){let t=e.querySelector(".z5jxId");t&&(d=parseInt(remove_non_numeric(t.innerText)))}}let m=s.querySelectorAll(gbp_extension_values.reviews_no_travel_review_complete_element_only).length,g=0;if(d<10&&m<10){let e=await await_for_elements(gbp_extension_values.reviews_no_travel_body,0);if(!e.has_el)return;if(!must_continue)return;s=e.result[0],process_reviews_data(document.querySelector(gbp_extension_values.reviews_no_travel_body_only),n,o,"r"),p++,_(d,p)}else{let e=0;for(;;){if(!must_continue)return;if(e++,e>=35)break;for await(i of[1,2,3]){if(i,!must_continue)return;if(p+=2,_(d,p),await sleep(50*i),p++,_(d,p),scroll_element(s),m=s.querySelectorAll(gbp_extension_values.reviews_no_travel_review_complete_element_only).length,m>=d){let e=await await_for_elements(gbp_extension_values.reviews_no_travel_body,0);if(!e.has_el)return;if(!must_continue)return;return s=e.result[0],process_reviews_data(document.querySelector(gbp_extension_values.reviews_no_travel_body_only),n,o,"r"),p++,_(d,p),void(document.getElementById("gbp-check-progress-bar-progress").style.width="49%")}{let e=5;for(;m==g;){if(!must_continue)return;if(e--,e<=0)break;await sleep(300);let t=await await_for_elements(gbp_extension_values.reviews_no_travel_body,0);if(!t.has_el)return;if(!must_continue)return;s=t.result[0],m=s.querySelectorAll(gbp_extension_values.reviews_no_travel_review_complete_element_only).length}g=m}}u++,u<=48&&(document.getElementById("gbp-check-progress-bar-progress").style.width=u+"%");let t=await await_for_elements(gbp_extension_values.reviews_no_travel_body,0);if(!t.has_el)return;if(!must_continue)return;if(s=t.result[0],m=s.querySelectorAll(gbp_extension_values.reviews_no_travel_review_complete_element_only).length,m>=d){let e=await await_for_elements(gbp_extension_values.reviews_no_travel_body,0);if(!e.has_el)return;if(!must_continue)return;return s=e.result[0],process_reviews_data(document.querySelector(gbp_extension_values.reviews_no_travel_body_only),n,o,"r"),p++,_(d,p),document.getElementById("gbp-check-progress-bar-progress").style.width="49%",await sleep(500),chrome.storage.local.remove("get_reviews_for_health_check_owner",(function(){})),void goto_maps_page(n)}if(p++,_(d,p),e%2==0){let e=await await_for_elements(gbp_extension_values.reviews_no_travel_body,0);if(!e.has_el)return;if(!must_continue)return;s=e.result[0];let t=process_reviews_data(s,n,o,"r");if(p++,_(d,p),!must_continue)return;if(!t.continue)break}}}await sleep(500),chrome.storage.local.remove("get_reviews_for_health_check_owner",(function(){})),document.getElementById("gbp-check-progress-bar-progress").style.width="49%",goto_maps_page(n)}function execute_search_page_health_check(e){if(!e&&gbp_extension_values&&gbp_extension_values.detecting_ownership_on_search&&gbp_extension_values.must_detect_ownership)for(let e of gbp_extension_values.detecting_ownership_on_search)if(document.querySelector(e))return void open_ownership_modal();function t(e){if(!must_continue)return;let t=e.email,a=e.id;if(!t||!a)return;document.getElementById("gbp-check-progress-bar-progress").style.width="5%";let n=is_fast_check?"1":"0";new Date;$.ajax({type:"POST",url:api_root_url_to_use+"/healthcheck/external/"+btoa(a),data:{data:document.body.getHTML(),method:"b",email:t,is_fast_check:n,place_id:get_place_id()},success:function(e){new Date;chrome.storage.local.get((function(t){if(!must_continue)return;let a;document.getElementById("gbp-check-progress-bar-progress").style.width="10%",t.user&&(a=t.user);let n=e.k,o={status:{p:"10%",now:Date(),method:"end_basic",is_fast_check:is_fast_check},reference_k:n,user:a};must_continue&&chrome.storage.local.set(o,(function(){}))}));let t=e.references,a=e.k;async_healthcheck=async function(e){if(!must_continue)return;if(document.getElementById("gbp-check-progress-bar-progress").style.width="12%",await sleep(150),!must_continue)return;if(document.getElementById("gbp-check-progress-bar-progress").style.width="13.5%",await sleep(200),!must_continue)return;if(document.getElementById("gbp-check-progress-bar-progress").style.width="15%",change_gbp_check_step("2/7"),document.getElementById("gbp-check-progress-child-label").innerText="Analisando Postagens",change_gbp_check_counter("-"),!must_continue)return;if(await async function(e){if(e.continue){let e=document.querySelector(".az0qve .Z07zMb");if(e){if(!must_continue)return;e.click(),await async function(){if(!must_continue)return;document.getElementById("gbp-check-progress-bar-progress").style.width="18%",await sleep(220);let e=await await_for_elements([".bErdLd.wwYr3.aID8W"],0);if(!e.has_el)return;if(!must_continue)return;let t=e.result[0];if(!(await await_for_elements([".aYexud"],0)).has_el)return;if(!must_continue)return;let a,n=0,o=-1,i=0;for(;await sleep(250),n++,!(n>=20);){if(!must_continue)return;if(a=document.querySelectorAll(".aYexud"),a.length==o){let e=0;for(let t=0;t<a.length;t++)(a[t].innerText.includes("/")||a[t].innerText.includes(",")||!a[t].innerText.includes("."))&&a[t].innerText||e++;if(e==a.length)continue;if(2==i&&(document.getElementById("gbp-check-progress-bar-progress").style.width="19%"),i++,i>=5){document.getElementById("gbp-check-progress-bar-progress").style.width="20%";break}}else i=0;o=a.length}let r=await readLocalStorage("reference_k"),s=await getUserData("user");if(!must_continue)return;if(process_data(document.body.getHTML(),"p",r,s),!must_continue)return;document.getElementById("gbp-check-progress-bar-progress").style.width="21%",await sleep(150);let l=t.getElementsByClassName("CeiTH yHy1rc eT1oJ pci9M");if(!must_continue)return;l.length>0&&l[1].click();t=document.querySelector(".bErdLd.wwYr3.aID8W"),n=0;for(;t&&(await sleep(100),n++,!(n>=15));)t=document.querySelector(".bErdLd.wwYr3.aID8W");await sleep(100)}()}}else await sleep(200),document.getElementById("gbp-check-progress-bar-progress").style.width="19%",await sleep(250),document.getElementById("gbp-check-progress-bar-progress").style.width="20%",await sleep(400),document.getElementById("gbp-check-progress-bar-progress").style.width="21%",await sleep(150)}(e.p),!must_continue)return;if(document.getElementById("gbp-check-progress-bar-progress").style.width="22%",change_gbp_check_step("3/7"),document.getElementById("gbp-check-progress-child-label").innerText="Analisando Perguntas e Respostas",!must_continue)return;if(await async function(e){if(!e)return;let t=document.querySelector(".QlPmEd");if(!t)return;if(change_gbp_check_counter(0),!must_continue)return;if(t.click(),!must_continue)return;document.getElementById("gbp-check-progress-bar-progress").style.width="23%";let a=await await_for_elements([".tlRQ11YQ67J__lupqa-p.tyESJkV0cFa__pqa-d"],0);if(!a.has_el)return;function n(e,t){t>e&&(t=e),change_gbp_check_counter(t)}q_and_a_modal=a.result[0];let o=0,r=e.t;if(!must_continue)return;document.getElementById("gbp-check-progress-bar-progress").style.width="25%",total_it=Array.from(Array(e.q).keys());let s=25,l=await readLocalStorage("reference_k"),c=await getUserData("user");for await(i of total_it)if(scroll_element(q_and_a_modal),await sleep(150),o+=3,n(r,o),await sleep(120),o+=2,n(r,o),await sleep(100),i%3==0||i==total_it.length){if(s+=1,s<=35){if(!must_continue)return;document.getElementById("gbp-check-progress-bar-progress").style.width=s+"%"}else document.getElementById("gbp-check-progress-bar-progress").style.width="35%";let e=process_data(document.body.getHTML(),"q_a",l,c);if(o+=3,n(r,o),await sleep(100),o+=2,n(r,o),!must_continue)return;if(!e.continue)break}let _=await await_for_elements(gbp_extension_values.close_q_e_a_el_modal,2);_=_.result[0],_.click()}(e.q),!must_continue)return;if(document.getElementById("gbp-check-progress-bar-progress").style.width="35%",change_gbp_check_step("4/7"),change_gbp_check_counter(0),document.getElementById("gbp-check-progress-child-label").innerText="Analisando Avaliações",await sleep(250),!must_continue)return;if(await get_reviews_for_health_check(e.r),!must_continue)return;if(document.getElementById("gbp-check-progress-bar-progress").style.width="50%",await sleep(250),!must_continue)return}(t),async_healthcheck.then((function(e){must_continue&&goto_maps_page(a)}),(function(e){}))},error:function(e){}})}async function a(){let e=await readCompleteStorageData();e=JSON.parse(JSON.stringify(e));const a=e.user;must_continue=!0,running_checklist=!0,add_progress_bar("2%","Analisando Informações Básicas","1/7");let n=document.querySelector(".wR7plc.xXEKkb");n&&n.click(),await sleep(150),must_continue&&(document.getElementById("gbp-check-progress-bar-progress").style.width="4%",t(a))}!async function(){let e=await readCompleteStorageData();e=JSON.parse(JSON.stringify(e));const t=e.user;let n;if(t&&(n=0!=Object.keys(t).length&&!(Object.getPrototypeOf(t)!=Object.prototype)),null==t&&(n=!1),n){chrome.storage.local.set({user:t},(function(){}));let e="pre";if(is_fast_check&&(e="fpre"),user_verified=verify_user(t,e),!user_verified.success)return void show_error_message(user_verified.error);if(user_verified.rule)return void show_rule_message(user_verified.rule,a);a()}else login()}()}function validator_cid_helper(e){return!/[^a-zA-Z0-9]/.test(e)}function hexToDec(e){var t,a,n,o=[0];for(t=0;t<e.length;t+=1){for(n=parseInt(e.charAt(t),16),a=0;a<o.length;a+=1)o[a]=16*o[a]+n,n=o[a]/10|0,o[a]%=10;for(;n>0;)o.push(n%10),n=n/10|0}return o.reverse().join("")}function extract_cid_from_maps_url(e){let t,a=window.location.href;e&&(a=e);let n,o=a.match(new RegExp(":0x","g"));if(!o)return"";for(i in o=o.length,o>1?(t=a.split(":0x"),t=t[t.length-1]):1==o&&(t=a.split(":0x")[1]),t)if(!validator_cid_helper(t[i])){n=t[i];break}return t=t.split(n)[0],hexToDec(t)}function get_maps_lat_lng(e){let t,a,n=window.location.href;e&&(n=e);try{return t=n.split("/@")[1].split(","),a={lat:t[0],lng:t[1]},a}catch{try{return t=n.split("!8m2!3d")[1].split("?")[0].split("!4d"),a={lat:t[0],lng:t[1]},a}catch{}}return{lat:"0",lng:"0"}}function create_categories_elements(e,t){let a=get_maps_lat_lng(t);if(!e||!a){let e=document.createElement("div");e.className="self-maps-main-item-patch";let t=document.createElement("span");return t.innerText+="Não foi possível obter as categorias desta localização.",t.className="category-el",t.style.backgroundColor="#db9090",e.appendChild(t),e}let n=document.createElement("div");n.className="self-maps-main-item-patch";let o=document.createElement("span");o.innerText="Categorias:",o.style.backgroundColor="transparent",o.style.paddingRight="2px",o.className="category-el",n.appendChild(o);for(let t=0;t<e.length;t++){let o=document.createElement("span");o.innerText+=e[t],o.className="category-el";let i="https://www.google.com/maps/search/"+e[t]+"/@"+a.lat+","+a.lng+",12z";o.onclick=function(){window.location.href=i},0==t&&(o.style.backgroundColor="#90dbbc"),n.appendChild(o)}return n}async function put_info_to_maps(e){lastEl=document.getElementById("gbpcheck_main_el_info"),lastEl&&lastEl.remove();let t=document.createElement("div");t.id="gbpcheck_main_el_info";let a=document.createElement("div");a.className="self-maps-main-item gbp-check-map-item";let n=document.createElement("div");n.innerText="CID",n.className="self-maps-item-title";let o=document.createElement("div");o.innerText=extract_cid_from_maps_url(),o.className="self-maps-text",a.appendChild(n),a.appendChild(o);let r=e[6][227][0][4],s=document.createElement("div");s.className="self-maps-main-item gbp-check-map-item";let l=document.createElement("div");l.innerText="PLACE ID",l.className="self-maps-item-title";let c=document.createElement("div");c.innerText=r,c.className="self-maps-text",s.appendChild(l),s.appendChild(c);let _=document.createElement("div");_.className="self-maps-main-item-patch";let u=document.createElement("span");u.innerText="Categorias:",u.style.backgroundColor="transparent",u.style.paddingRight="2px",u.className="category-el",_.appendChild(u);let d=get_maps_lat_lng();for(let e=0;e<categories.length;e++){let t=document.createElement("span");t.innerText+=categories[e],t.className="category-el";let a="https://www.google.com/maps/search/"+categories[e]+"/@"+d.lat+","+d.lng+",12z";t.onclick=function(){window.location.href=a},0==e&&(t.style.backgroundColor="#90dbbc"),_.appendChild(t)}t.appendChild(_);try{let a=e[6][52][17][1][3][0],n=document.createElement("div");n.className="self-maps-main-item-patch";let o=document.createElement("span");o.innerText="Serviços:",o.style.backgroundColor="transparent",o.style.paddingRight="2px",o.className="category-el",n.appendChild(o);for(let e=0;e<a.length;e++){let t="#96bfff";if(1!=a[e][3]&&(t="#b3b3b3"),4==a[e][3])continue;let o=document.createElement("span");o.innerText+=a[e][1],o.className="category-el",o.style.backgroundColor=t,n.appendChild(o)}n.childElementCount&&t.appendChild(n)}catch(e){}t.appendChild(a),t.appendChild(s);let p=document.querySelector(".x3AX1-LfntMc-header-title");if(!p)for await(i of[1,2,3,4,5])if(await sleep(500*i),p=document.querySelector(".x3AX1-LfntMc-header-title"),p)break;p&&p.appendChild(t)}async function parse_categories_info_for_location(e,t,a,n){let o,i=t.querySelector(".self-maps-main-item-patch");i&&i.remove();let r=await parse_categories_for_location(e,n);if(!r)return!0;if(!r.length)return!1;if(o=create_categories_elements(r,e),a){let n={categories:r,html_data:t.innerHTML,url:e,gbp_element:o};a[e]=n}return t.querySelector(".self-maps-main-item-patch")||o&&t.appendChild(o),!0}function get_urls_for_multiple_locations_categories(){let e=document.querySelectorAll(gbp_extension_values.maps_utilities.multiple_locations_anchors),t=[];return e.forEach((e=>{t.push(e.getAttribute("href"))})),t}async function add_ranking_position_to_locations(){if((!categories_process||can_run_categories_process)&&(completed_multiple=!1,locations_els=await await_for_elements(gbp_extension_values.maps_utilities.multiple_locations_els,0,!1),locations_els.has_el)){locations_els=locations_els.result;for(let e=0;e<locations_els.length;e++){locations_els[e].querySelector(".self-maps-location-ranking-el")&&locations_els[e].querySelector(".self-maps-location-ranking-el").remove();let t=document.createElement("span");t.className="self-maps-location-ranking-el category-el",t.style="background-color: rgb(0, 153, 238); color: white; font-size:9px;",t.innerHTML=`\n                ${e+1}\n        `;try{locations_els[e].querySelector(".self-maps-main-item-patch").appendChild(t)}catch{}}}}async function add_multiple_locations_categories_data(){if(categories_process&&!can_run_categories_process)return;if(!completed_multiple)return;if(completed_multiple=!1,locations_els=await await_for_elements(gbp_extension_values.maps_utilities.multiple_locations_els,0,!1),urls=get_urls_for_multiple_locations_categories(),!locations_els.has_el)return;if(locations_els=locations_els.result,urls.length!=locations_els.length)return;let e=[],t=[];for(let a=0;a<locations_els.length;a++)if(locations_already_sent_to_parse.includes(urls[a])){let e=locations_already_sent_to_parse_dict[urls[a]];if(e){e=locations_already_sent_to_parse_dict[urls[a]].gbp_element;let t=locations_els[a].querySelector(".self-maps-main-item-patch");t&&t.remove(),locations_els[a].appendChild(e)}}else locations_already_sent_to_parse.push(urls[a]),e.push(urls[a]),t.push(locations_els[a]);let a=e.length<=100?e.length:100;document.getElementById("gbp-check-progress-child-label")&&(document.getElementById("gbp-check-progress-child-label").innerText="Verificando Categorias Das Localizações",change_gbp_check_counter("0/"+a));let n=0;for(let o=0;o<e.length;o++)if(categories_process){if(!await parse_categories_info_for_location(e[o],t[o],locations_already_sent_to_parse_dict,!1)){if(n+=1,n>=3)break;await sleep(5e3),await parse_categories_info_for_location(e[o],t[o],locations_already_sent_to_parse_dict,!1)}if(await sleep(100),0==o)continue;if(o%2==0&&await sleep(50),o%5==0&&await sleep(100),o%10==0&&await sleep(1e3),o%15==0&&await sleep(200*o/5),o%30==0&&await sleep(5e3),o>=MAX_CATEGORIES_AUDIT_ALLOWED_LOCATIONS-1)break;change_gbp_check_counter(o+1+"/"+a),document.getElementById("gbp-check-progress-bar-progress").style.width=55+(o+1)/a*40<=95?55+(o+1)/a*40+"%":"95%"}else parse_categories_info_for_location(e[o],t[o],locations_already_sent_to_parse_dict,!1);if(categories_process&&main_location_for_category_data&&running_checklist){let e=Object.values(locations_already_sent_to_parse_dict);document.getElementById("gbp-check-progress-bar-progress").style.width="95%",send_categories_audit_data(e,main_location_for_category_data),running_checklist=!1,categories_process=!1,can_run_categories_process=!1,already_sent_categories=!0}completed_multiple=!0}let locations_already_sent_to_parse_dict={},locations_already_sent_to_parse=[],self_location_cid="",completed=!0,completed_multiple=!0,retry=0,last_specification="",last_location_name="",changed_location=!1,last_global_search_for_free_query="";async function timer_controller_for_maps_categories(){const e=(await readCompleteStorageData()).user;let t;if(t=null!=e&&!(0===Object.keys(e).length&&Object.getPrototypeOf(e)===Object.prototype),!t)return;if((!completed||running_checklist)&&!categories_process)return;let a=await get_gbp_check_page_specification();const n=a.IS_SELF_MAPS,o=a.IS_MAPS_WITH_SEARCH,i=a.IS_MAPS_WITHOUT_SEARCH;let r="";if(n){if(last_specification||(last_specification="IS_SELF_MAPS"),r="IS_SELF_MAPS",info_pack_for_location=document.querySelector(gbp_extension_values.maps_utilities.info_pack_for_location),!info_pack_for_location)return;if(this_cid=extract_cid_from_maps_url(),self_location_cid!=this_cid)return changed_location=!0,self_location_cid=this_cid,parse_categories_info_for_location(window.location.href,info_pack_for_location,null,!0),retry=0,void await sleep(1e7);info_pack_for_location.querySelector(".self-maps-main-item-patch")||(retry++,retry<=4&&parse_categories_info_for_location(window.location.href,info_pack_for_location,null,!0))}if(o&&(n||(last_specification||(last_specification="IS_MAPS_SEARCH_ALL"),r="IS_MAPS_SEARCH_ALL"),add_multiple_locations_categories_data(),add_ranking_position_to_locations()),!i||n||o||(last_specification||(last_specification="IS_MAPS_WITHOUT_SEARCH"),r="IS_MAPS_WITHOUT_SEARCH"),o&&n&&(r="IS_SELF_MAPS"),last_specification!=r||changed_location&&"IS_SELF_MAPS"==r){changed_location=!1,last_specification=r;let e=document.getElementById("maps_options_lateral_box_body");e&&await fill_area_lateral_body(a,e)}n&&document.getElementById("gbp-check-main-maps-name")&&global_maps_self_page_place_name&&(document.getElementById("gbp-check-main-maps-name").innerText=global_maps_self_page_place_name),completed=!0}async function reset_main_gbp_box(e){const t=window.location.pathname.includes("/maps"),a=window.location.pathname.includes("/create"),n=window.location.pathname.includes("/travel"),o=!t&&!a&&!n;if(window.location.href.includes("business.google."))window.location.reload();else if(o){document.getElementById("gbp-check-main-container").remove(),add_secondary_container_button(add_main_gbp_check_container(e,document.querySelector(".liYKde.g.VjDLd"),"gbp-check-main-container-self-search"),e)}else t&&(e?(locations_already_sent_to_parse=[],locations_already_sent_to_parse_dict={},self_location_cid="",completed=!0,completed_multiple=!0,retry=0,create_maps_options_lateral_box()):document.getElementById("gbp_check_maps_options_lateral_container")&&document.getElementById("gbp_check_maps_options_lateral_container").remove())}function get_location_name(){let e;for(let t of gbp_extension_values.maps_utilities.location_name_maps)if(e=document.querySelector(t),e)return e.innerText;return""}async function get_location_name_async(e){let t;for(let e of gbp_extension_values.maps_utilities.location_name_maps)if(t=document.querySelector(e),t)return t.innerText;for await(i of[1,2,3,4,5]){await sleep(200),await sleep(100*i);for(let e of gbp_extension_values.maps_utilities.location_name_maps)if(t=document.querySelector(e),t)return t.innerText}return t?t.innerText:""}window.addEventListener("load",(()=>set_extension()),!1);let running_this=!1,is_self_maps_last=!1;async function fill_area_lateral_body(e,t){let a=e.IS_SELF_MAPS,n=e.IS_MAPS_WITH_SEARCH,o=e.IS_MAPS_WITHOUT_SEARCH;a&&n&&(n=!1),is_self_maps_last=a;let r=document.getElementById("gbp-check-main-maps-name");if(r=r?r.innerText:"",t.innerHTML="",n){t.style="";let e=document.createElement("h2");e.innerText="Análise de Categorias",e.style.textAlign="center",e.className="maps_options_lateral_box_body_title",e.style.fontWeight="bold";let a=document.createElement("p");a.innerText="\n        Analisa a categoria dos perfis do resultado desta pesquisa, ajudando a identificar as melhores categorias (principal e adicionais) para a palavra chave.\n        ",a.style.textAlign="center";let n=document.createElement("div");n.className="main-btn",n.style.padding="8px 41px",n.style.display="table-cell",n.innerText="Análise de Categorias",n.addEventListener("click",(()=>{categories_process=!0,can_run_categories_process=!1,running_checklist=!0,must_continue=!0,add_progress_bar("3%","Analisando Categoria Por Palavra Chave","-"),analyze_category_of_text_query_search()})),t.appendChild(e),t.appendChild(a),t.appendChild(n)}else if(a){if(running_this)return;for await(i of(running_this=!0,[1,2,3,4,5])){if(global_maps_self_page_place_id)break;await sleep(200+200*i)}let a=extract_cid_from_maps_url();for await(i of[1,2,3,4,5]){if(a)break;await sleep(500+200*i),a=extract_cid_from_maps_url()}if(!(e=await get_gbp_check_page_specification()).IS_SELF_MAPS)return void(running_this=!1);t.style.paddingLeft="20px",t.style.paddingRight="20px",t.style.justifyContent="initial",t.style.alignItems="baseline",lat_lng=get_maps_lat_lng(),lat_lng||(lat_lng={lat:0,lng:0});let n=document.createElement("div");n.style.width="85%";let o=document.createElement("h2");o.id="gbp-check-main-maps-name",o.classList.add("maps_options_lateral_box_body_title"),o.style.textAlign="left",o.style.paddingLeft="0px",o.style.fontWeight="bold",o.innerText=await get_location_name_async(r);let s=document.createElement("hr");s.style.width="100%",s.style.background="black",n.appendChild(o),n.appendChild(s),t.appendChild(n);let l=document.createElement("div");l.style="display:flex; justify-content:center; width:100%;";let c=document.createElement("a");c.className="main-btn",c.style="padding: 4px 22px; display:table-cell; height: 16px; margin-top:20px;",c.href="https://local.google.com/place?id="+a+"&use=srp",c.target="_blank",c.innerText="Ver na Pesquisa",l.appendChild(c),t.appendChild(l);let _=document.createElement("div");_.classList.add("options-holder");let u=document.createElement("div");u.className="maps-item-table-location";let d=document.createElement("div");d.innerHTML="<b>CID: </b>"+a;let p=document.createElement("img");p.className="copy-icon",p.src="chrome-extension://eahmehikldfandakklkgiobdnmmhbhle/images/copy_paste.png",p.onclick=()=>{value_to_clipboard(a,"CID Copiado Para Área De Transferência")},u.appendChild(d),u.appendChild(p),_.appendChild(u);let m=document.createElement("hr");m.className="item-maps-hr",_.appendChild(m);let g=document.createElement("div");g.className="maps-item-table-location";let h=document.createElement("div");h.innerHTML="<b>PLACE ID: </b>"+global_maps_self_page_place_id;let f=document.createElement("img");f.className="copy-icon",f.src="chrome-extension://eahmehikldfandakklkgiobdnmmhbhle/images/copy_paste.png",f.onclick=()=>{value_to_clipboard(global_maps_self_page_place_id,"Place ID Copiado Para Área De Transferência")},g.appendChild(h),g.appendChild(f),_.appendChild(g);let b=document.createElement("hr");b.className="item-maps-hr",_.appendChild(b);let y=document.createElement("div");y.className="maps-item-table-location";let w=document.createElement("div");w.innerHTML="<b>GPS: </b>"+lat_lng.lat+", "+lat_lng.lng;let v=document.createElement("img");v.className="copy-icon",v.src="chrome-extension://eahmehikldfandakklkgiobdnmmhbhle/images/copy_paste.png",v.onclick=()=>{value_to_clipboard(lat_lng.lat+", "+lat_lng.lng,"Coordenadas Copiadas Para Área De Transferência")},y.appendChild(w),y.appendChild(v),_.appendChild(y);let k=document.createElement("hr");k.className="item-maps-hr",_.appendChild(k);let x=document.createElement("div");x.className="maps-item-table-location";let E=document.createElement("div");E.innerHTML="<b>KG ID: </b>"+global_maps_self_page_kg_id;let S=document.createElement("img");S.className="copy-icon",S.src="chrome-extension://eahmehikldfandakklkgiobdnmmhbhle/images/copy_paste.png",S.onclick=()=>{value_to_clipboard(global_maps_self_page_kg_id,"KG ID Copiado Para Área De Transferência")},x.appendChild(E),x.appendChild(S),_.appendChild(x);let A=document.createElement("hr");A.className="item-maps-hr",_.appendChild(A);let I=document.createElement("div");I.className="maps-item-table-location";let T=document.createElement("div");T.innerHTML="<b>STATUS: </b>"+get_location_ownership_status(),I.appendChild(T),_.appendChild(I);let C=document.createElement("hr");C.className="item-maps-hr",_.appendChild(C),t.appendChild(_),categories_audit_holder=document.createElement("div"),categories_audit_holder.classList.add("categories-audit-holder");let L=document.createElement("div");L.className="main-btn main-btn-maps",L.innerText="Análise de Categorias",L.addEventListener("click",(()=>{categories_process=!0,can_run_categories_process=!1,running_checklist=!0,must_continue=!0,add_progress_bar("3%","Analisando Categoria da Localização","-"),analyze_category_of_business()})),categories_audit_holder.appendChild(L),t.appendChild(categories_audit_holder),running_this=!1}else o&&(t.style="",t.innerHTML="\n        <h2 class='maps_options_lateral_box_body_title'>Bem vindo ao<br><b>GBP Check</b></h2>\n        <p>\n        1. Pesquise pelo nome de um local no campo da pesquisa e abra este menu para mais informações do perfil.\n        <br><br>\n        ou\n        <br><br>\n        2. Pesquise por uma palavra chave no campo de pesquisa e abra este menu para efetuar uma análise das categorias mais relevantes para esta palavra chave.\n        </p>\n        ")}function get_location_ownership_status(){has_ownership=!0,possible_labels_for_unverified_business=gbp_extension_values.POSSIBLE_LABELS_FOR_UNVERIFIED,possible_els_queries=gbp_extension_values.QUERIES_FOR_UNVERIFIED;for(let e=0;e<possible_els_queries.length;e++){let t=document.querySelector(possible_els_queries[e]);if(t){let e=t.innerText;if(possible_labels_for_unverified_business.includes(e)){has_ownership=!1;break}}}return has_ownership?"<span class='verified-class'>Verificado</span>":"<span class='unverified-class'>Não verificado</span>"}async function create_maps_options_lateral_box(){let e=document.createElement("div");e.id="gbp_check_maps_options_lateral_container",e.classList.add("gbp-check-maps-options-lateral-container");let t=document.createElement("div");t.classList.add("maps-options-lateral-box");let a=document.createElement("div");a.classList.add("maps-options-lateral-box-header");let n=document.createElement("img");n.className="gbp-check-icon-header-maps",n.src="chrome-extension://eahmehikldfandakklkgiobdnmmhbhle/images/gmb-chec-v-transparent-white.png",a.appendChild(n);let o=document.createElement("div");o.id="maps_options_lateral_box_body",o.classList.add("maps-options-lateral-box-body"),specification=await get_gbp_check_page_specification(),await fill_area_lateral_body(specification,o);let i=document.createElement("div");i.classList.add("gbp-check-maps-lateral-button");let r=document.createElement("img");r.src="chrome-extension://eahmehikldfandakklkgiobdnmmhbhle/images/gmb-chec-v-transparent-white.png",r.classList.add("gbp-check-maps-lateral-button-img");let s=document.createElement("img");s.src="chrome-extension://eahmehikldfandakklkgiobdnmmhbhle/images/back.png",s.classList.add("gbp-check-maps-lateral-button-img"),s.style.display="none",s.style.height="15px",s.style.width="15px",i.appendChild(r),i.appendChild(s),i.addEventListener("click",(()=>{e.classList.contains("slide-in")?(e.classList.remove("slide-in"),e.classList.add("slide-out"),r.style.display="block",s.style.display="none"):e.classList.contains("slide-out")?(e.classList.remove("slide-out"),e.classList.add("slide-in"),r.style.display="none",s.style.display="block"):(e.classList.add("slide-in"),r.style.display="none",s.style.display="block")})),t.appendChild(a),t.appendChild(o),e.appendChild(i),e.appendChild(t),document.body.appendChild(e)}async function get_gbp_check_page_specification(){let e=await readCompleteStorageData();e=JSON.parse(JSON.stringify(e));const t=window.location.pathname.includes("/maps"),a=window.location.pathname.includes("/create"),n=window.location.pathname.includes("/travel"),o=!t&&!a&&!n;e.status&&(is_fast_check=e.status.is_fast_check);const i=e.user;let r;r=null!=i&&!(0===Object.keys(i).length&&Object.getPrototypeOf(i)===Object.prototype);const s=verify_if_all_elements_exists_together(gbp_extension_values.maps_specifications.IS_GBP_PAGE),l=r&&compare_qty_for_list(gbp_extension_values.maps_specifications.IS_MULTI_GBP_PAGE.compare_qty)&&verify_if_all_elements_exists_together(gbp_extension_values.maps_specifications.IS_MULTI_GBP_PAGE.verify_exists),c=verify_if_any_element_exists(gbp_extension_values.maps_specifications.IS_MAPS_WITH_SEARCH),_=verify_if_all_elements_exists_together(gbp_extension_values.maps_specifications.IS_SELF_MAPS);return{IS_MAPS:t,IS_CREATE:a,IS_TRAVEL:n,IS_SEARCH:o,IS_GBP_PAGE:s,IS_MULTI_GBP_PAGE:l,HAS_LOGGED_USER:r,IS_MAPS_WITHOUT_SEARCH:!c&&!_,IS_MAPS_WITH_SEARCH:c,IS_SELF_MAPS:_}}async function send_page_for_debug(){return new Promise((async(e,t)=>{let a=document.body.innerHTML,n=await readCompleteStorageData();n=JSON.parse(JSON.stringify(n));const o=n.user;let i;if(i=null!=o&&!(0===Object.keys(o).length&&Object.getPrototypeOf(o)===Object.prototype),i)try{html2canvas(document.body).then((function(n){var i=n.toDataURL("image/png");let r=chrome.runtime.getManifest().version,s={data:a,user:o,url:window.location.href,extension_version:r,cap:i};$.ajax({type:"POST",url:api_root_url_to_use+"/debug",async:!1,timeout:3e4,data:s,success:function(t){e("Página enviada para debug com sucesso.")},error:function(){t("Falha ao enviar a página para debug.")}})}))}catch{let n=chrome.runtime.getManifest().version,i={data:a,user:o,url:window.location.href,extension_version:n,cap:""};$.ajax({type:"POST",url:api_root_url_to_use+"/debug",async:!1,timeout:3e4,data:i,success:function(t){e("Página enviada para debug com sucesso.")},error:function(){t("Falha ao enviar a página para debug.")}})}else t("Usuário não está logado.")}))}async function set_extension(){const e=window.location.href;set_modal();let t=await readCompleteStorageData();t=JSON.parse(JSON.stringify(t));const a=window.location.pathname.includes("/maps"),n=window.location.pathname.includes("/maps/search/"),o=window.location.pathname.includes("/create"),i=window.location.pathname.includes("/travel"),r=window.location.href.includes("business.google."),s=(r&&window.location.pathname.includes("/locations"),!a&&!o&&!i);t.status&&(is_fast_check=t.status.is_fast_check);const l=t.user;let c;if(c=null!=l&&!(0===Object.keys(l).length&&Object.getPrototypeOf(l)===Object.prototype),r&&!c&&login(),r&&c&&(GBP_BUSINESS_MANAGEMENT_PAGE=await get_gbp_business_management_values(l)),c&&r&&GBP_BUSINESS_MANAGEMENT_PAGE.rewrite_menu_text)try{let e;for(let t=0;t<GBP_BUSINESS_MANAGEMENT_PAGE.dashboard_menu_item_to_change_to_go_to_maps_text.length&&(e=document.querySelector(GBP_BUSINESS_MANAGEMENT_PAGE.dashboard_menu_item_to_change_to_go_to_maps_text[t]),null==e);t++);null!=e&&(navigator.language.includes("pt")||!navigator.language||navigator.language.includes("BR")||navigator.language.includes("br")?e.innerText="Ir para o Maps":e.innerText="Go to Maps")}catch{}const _=t.reference_k,u=t.status?t.status:{},d=u.now?new Date(u.now):void 0,p=new Date,m=d?(p.getTime()-d.getTime())/1e3:void 0,g=u.p,h=u.method,f=!(m>27),b="map"==h&&a&&f,y="m"==h&&a&&f,w="verify_area"==h&&a&&f,v="start_rank_on_maps"==h&&a&&f,k="travel_reviews"==h&&i&&f,x="start_categories_audit"==h&&a&&f;c&&(gbp_extension_values=await get_gbp_extension_values(l)),get_and_set_css();let E=await get_gbp_search_holder_extension_values();t.reviews_audit_storage_start_owner&&s&&start_reviews_audit_after_rule(),t.get_reviews_for_health_check_owner&&s&&(running_checklist=!0,must_continue=!0,add_progress_bar("36%","Analisando Avaliações","-"),await get_reviews_for_health_check(JSON.parse(t.get_reviews_for_health_check_owner)));let S=!0;for(verifier of E.verifiers)S=Boolean(document.querySelector(verifier))&&S;const A=S,I=c&&compare_qty_for_list(gbp_extension_values.maps_specifications.IS_MULTI_GBP_PAGE.compare_qty)&&verify_if_all_elements_exists_together(gbp_extension_values.maps_specifications.IS_MULTI_GBP_PAGE.verify_exists);if(window.onoffline=()=>{change_health_check_to_error("A conexão com a rede foi perdida. Por favor recomece o processo.")},chrome.runtime.onMessage.addListener((function(e,t,a){if("logged_in"===e.message)modal=document.getElementById("gbp-check-modal").style.display="none",reset_main_gbp_box(),readCompleteStorageData().then((e=>{const t=(e=JSON.parse(JSON.stringify(e))).user;gbp_extension_values=get_gbp_extension_values(void 0);const a=!(t&&0===Object.keys(t).length&&Object.getPrototypeOf(t)===Object.prototype);a&&(show_copy_notification_success("Login Realizado com Sucesso!","Obrigado por utilizar o GBP Check!"),window.location.reload(),reset_main_gbp_box(a))}));else if("auth_user"===e.message)auth_user();else if("get_url"===e.message)a({url:window.location.href,pathname:window.location.pathname});else if("debug"===e.message)return send_page_for_debug().then((e=>{a({status:e})})).catch((e=>{a({status:e})})),!0;return!1})),s&&!A&&!I)return;if(s){let t=null;for(verifier of E.gbp_holder)if(t=document.querySelector(verifier),t)break;if(!t)return;add_secondary_container_button(add_main_gbp_check_container(c,t,"gbp-check-main-container-self-search"),c),add_dropdown_click_listener();const a=getUrlParameter(e,"start_p");return void(a&&c&&("1"==a?document.querySelector(".start-main-check-btn").click():"2"==a?document.querySelector("#reviews_audit_btn").click():"3"==a?document.querySelector("#post_audit_btn").click():"4"==a?document.querySelector("#categories_audit_btn").click():"5"==a&&document.querySelector("#reviews_card_btn").click()))}if(a&&(locations_already_sent_to_parse=[],locations_already_sent_to_parse_dict={},self_location_cid="",completed=!0,completed_multiple=!0,retry=0,c&&create_maps_options_lateral_box(),setInterval(timer_controller_for_maps_categories,500)),n){let e=await readCompleteStorageData();if(e=JSON.parse(JSON.stringify(e)),e.categories_audit_data)return await removeDataFromStorage("categories_audit_data"),categories_process=!0,can_run_categories_process=!1,running_checklist=!0,must_continue=!0,add_progress_bar("3%","Analisando Categoria da Localização","-"),categories_audit_data=e.categories_audit_data,void analyze_category_of_business_list_for_categories_audit(categories_audit_data)}if(i){let e=await readCompleteStorageData();if(e=JSON.parse(JSON.stringify(e)),e.reviews_audit_storage)return await removeDataFromStorage("reviews_audit_storage"),add_progress_bar("2%","Análise de Avaliações","-"),void execute_travel_reviews_audit()}if("cancel"==h)return must_continue=!1,void(running_checklist=!1);let T={status:u,reference_k:_,user:l};chrome.storage.local.set(T,(function(){})),b?(running_checklist=!0,add_progress_bar(g,"Analisando Informações do Mapa","5/7"),await wait_for_maps_to_change_url(),execute_maps_page_basic_health_check()):y?(running_checklist=!0,add_progress_bar(g,"Analisando Mídia","6/7"),execute_media_page_health_check()):w?(running_checklist=!0,add_progress_bar(g,"Analisando Concorrentes na Região","7/7"),execute_maps_area_health_check()):v?(running_checklist=!0,add_progress_bar(g,"Analisando Concorrentes na Região"),start_location_ranking_on_maps()):k?(running_checklist=!0,add_progress_bar(g,"Analisando Avaliações","4/7"),execute_travel_reviews_health_check()):x?(categories_process=!0,can_run_categories_process=!1,running_checklist=!0,must_continue=!0,add_progress_bar("3%","Analisando Categoria da Localização","-"),await wait_for_maps_to_change_url(),analyze_category_of_business()):running_checklist=!1}function add_dropdown_click_listener(){document.addEventListener("click",(function(e){var t=(e=e||window.event).target;drop_content=document.getElementById("gbp-utilities-dropdown-content");const a="utilities-gbp-check-btn"==t.id,n=drop_content.contains(t);a||n?a?"block"!=drop_content.style.display?drop_content.style.display="block":drop_content.style.display="none":n&&("A"!=t.nodeName&&"a"!=t.nodeName?drop_content.style.display="block":drop_content.style.display="none"):drop_content.style.display="none"}),!1)}window.addEventListener("error",(function(e,t,a,n,o){}));